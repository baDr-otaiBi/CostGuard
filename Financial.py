#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØªÙ‚Ø¯Ù… Ù„Ù…ØªØ§Ø¬Ø± Ø³Ù„Ø©                      â•‘
â•‘  Advanced Financial Analytics System for Salla Stores       â•‘
â•‘  Ø§Ù„Ù†Ø³Ø®Ø©: 3.0 - AI-Powered Edition                           â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Ù…Ù…ÙŠØ²Ø§Øª Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…Ø¯Ø¹ÙˆÙ…Ø© Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ:
âœ… ØªÙ‚Ø±ÙŠØ± Ø´Ø§Ù…Ù„ Ø¨Ù€ 20+ ØµÙØ­Ø© Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„ÙƒØ§Ù…Ù„Ø©
âœ… ØªØ­Ù„ÙŠÙ„Ø§Øª Ù…Ø§Ù„ÙŠØ© Ø¹Ù…ÙŠÙ‚Ø© Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙÙˆØ±ÙŠ
âœ… Ø±Ø³ÙˆÙ… Ø¨ÙŠØ§Ù†ÙŠØ© Ø§Ø­ØªØ±Ø§ÙÙŠØ© Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©
âœ… ØªÙˆØµÙŠØ§Øª Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªÙ†ÙÙŠØ°
âœ… ØªØ­Ù„ÙŠÙ„ ABC + ØªØ­Ù„ÙŠÙ„ RFM + ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø§Ø±ØªØ¨Ø§Ø·Ø§Øª
âœ… Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© (KPIs)
âœ… ØªÙ†Ø¨Ø¤Ø§Øª Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ (AI Sales Forecasting)
âœ… ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„Ø°ÙƒÙŠ (AI Customer Segmentation)
âœ… ÙƒØ´Ù Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø´Ø§Ø°Ø© (Anomaly Detection)
âœ… ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠ (Dynamic Price Optimization)
âœ… ØªÙˆØµÙŠØ§Øª Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø°ÙƒÙŠØ© (Smart Product Recommendations)
âœ… ØªÙ‚Ø§Ø±ÙŠØ± PDF Ø§Ø­ØªØ±Ø§ÙÙŠØ© Ù…Ø¹ Ø±Ø¤Ù‰ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ
"""

import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns
from datetime import datetime, timedelta
import warnings
import random
from pathlib import Path
import locale
import json
import logging
from collections import defaultdict

# AI/ML Libraries
try:
    from sklearn.cluster import KMeans
    from sklearn.preprocessing import StandardScaler
    from sklearn.ensemble import IsolationForest, RandomForestRegressor
    from sklearn.linear_model import LinearRegression
    from sklearn.model_selection import train_test_split
    from sklearn.metrics import mean_absolute_error, mean_squared_error, r2_score
    ML_AVAILABLE = True
except ImportError:
    ML_AVAILABLE = False
    print("âš ï¸  ØªØ­Ø°ÙŠØ±: Ù…ÙƒØªØ¨Ø§Øª Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ ØºÙŠØ± Ù…ØªÙˆÙØ±Ø©. Ø³ÙŠØªÙ… ØªØ´ØºÙŠÙ„ Ø§Ù„Ù†Ø¸Ø§Ù… Ø¨Ø¯ÙˆÙ† Ù…ÙŠØ²Ø§Øª AI")
    print("   Ù„ØªØ«Ø¨ÙŠØª Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª: pip install scikit-learn")

warnings.filterwarnings('ignore')

# Ø¥Ø¹Ø¯Ø§Ø¯ Ù†Ø¸Ø§Ù… Ø§Ù„Ø³Ø¬Ù„Ø§Øª (Logging)
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(levelname)s - %(message)s',
    handlers=[
        logging.FileHandler('costguard_ai.log'),
        logging.StreamHandler()
    ]
)

# Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø®Ø·ÙˆØ· Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ù„Ù€ matplotlib
plt.rcParams['font.family'] = 'DejaVu Sans'
plt.rcParams['axes.unicode_minus'] = False

print("=" * 70)
print("ğŸš€ Ø¨Ø¯Ø¡ Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØªÙ‚Ø¯Ù… - Salla Analytics Pro")
print("=" * 70)


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# [1] Ù…ÙˆÙ„Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù… - Advanced Data Generator
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

def generate_advanced_salla_data():
    """
    ÙŠÙˆÙ„Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù‚Ø¹ÙŠØ© Ù…Ø¹Ù‚Ø¯Ø© ØªØ­Ø§ÙƒÙŠ Ù…ØªØ¬Ø± Ø³Ù„Ø© Ø­Ù‚ÙŠÙ‚ÙŠ
    - Ù…ÙˆØ§Ø³Ù… ÙˆØ£Ø¹ÙŠØ§Ø¯
    - Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø°Ø±ÙˆØ©
    - Ù‡ÙˆØ§Ù…Ø´ Ø±Ø¨Ø­ Ù…ØªÙØ§ÙˆØªØ©
    - Ø£Ù†Ù…Ø§Ø· Ø´Ø±Ø§Ø¡ ÙˆØ§Ù‚Ø¹ÙŠØ©
    """
    print("\n[1/8] ğŸ—ï¸  ØªÙˆÙ„ÙŠØ¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªØ¬Ø± Ø§Ù„Ù…Ø­Ø§ÙƒÙŠ...")
    
    # Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©
    products_db = {
        'iPhone 15 Pro Max': {'price': 5500, 'cost': 4900, 'category': 'Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª', 'supplier': 'Apple'},
        'Samsung Galaxy S24': {'price': 4200, 'cost': 3700, 'category': 'Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª', 'supplier': 'Samsung'},
        'Ø¬Ø±Ø§Ø¨ Ø´ÙØ§Ù Ø¢ÙŠÙÙˆÙ†': {'price': 60, 'cost': 8, 'category': 'Ø¥ÙƒØ³Ø³ÙˆØ§Ø±Ø§Øª', 'supplier': 'Ù…Ø­Ù„ÙŠ'},
        'Ø´Ø§Ø­Ù† Ù„Ø§Ø³Ù„ÙƒÙŠ Ø³Ø±ÙŠØ¹': {'price': 180, 'cost': 90, 'category': 'Ø¥ÙƒØ³Ø³ÙˆØ§Ø±Ø§Øª', 'supplier': 'Anker'},
        'Ø³Ù…Ø§Ø¹Ø§Øª AirPods Pro': {'price': 990, 'cost': 850, 'category': 'ØµÙˆØªÙŠØ§Øª', 'supplier': 'Apple'},
        'Ù…Ø§ÙˆØ³ Ø£Ù„Ø¹Ø§Ø¨ RGB': {'price': 280, 'cost': 160, 'category': 'Ù…Ù„Ø­Ù‚Ø§Øª Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ±', 'supplier': 'Logitech'},
        'ÙƒÙŠØ¨ÙˆØ±Ø¯ Ù…ÙŠÙƒØ§Ù†ÙŠÙƒÙŠ': {'price': 650, 'cost': 420, 'category': 'Ù…Ù„Ø­Ù‚Ø§Øª Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ±', 'supplier': 'Razer'},
        'ÙˆØ§Ù‚ÙŠ Ø´Ø§Ø´Ø© Ø²Ø¬Ø§Ø¬ÙŠ': {'price': 35, 'cost': 3, 'category': 'Ø¥ÙƒØ³Ø³ÙˆØ§Ø±Ø§Øª', 'supplier': 'Ù…Ø­Ù„ÙŠ'},
        'ÙƒÙŠØ¨Ù„ USB-C 2Ù…': {'price': 85, 'cost': 22, 'category': 'Ø¥ÙƒØ³Ø³ÙˆØ§Ø±Ø§Øª', 'supplier': 'Baseus'},
        'Ø­Ø§Ù…Ù„ Ù„Ø§Ø¨ØªÙˆØ¨ Ø®Ø´Ø¨ÙŠ': {'price': 170, 'cost': 90, 'category': 'Ù…ÙƒØªØ¨ÙŠØ©', 'supplier': 'Ù…Ø­Ù„ÙŠ'},
        'Ø¨Ø§ÙˆØ± Ø¨Ø§Ù†Ùƒ 20000mAh': {'price': 195, 'cost': 110, 'category': 'Ø¥ÙƒØ³Ø³ÙˆØ§Ø±Ø§Øª', 'supplier': 'Anker'},
        'Ø³Ø¬Ø§Ø¯Ø© Ù…ÙƒØªØ¨ XXL': {'price': 120, 'cost': 50, 'category': 'Ù…ÙƒØªØ¨ÙŠØ©', 'supplier': 'Ù…Ø­Ù„ÙŠ'},
        'Ø³Ù…Ø§Ø¹Ø© Ø±Ø£Ø³ Ø¨Ù„ÙˆØªÙˆØ«': {'price': 340, 'cost': 200, 'category': 'ØµÙˆØªÙŠØ§Øª', 'supplier': 'Sony'},
        'Ø³Ø§Ø¹Ø© Ø°ÙƒÙŠØ© S9': {'price': 1800, 'cost': 1500, 'category': 'Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª', 'supplier': 'Samsung'},
        'Ø­Ù‚ÙŠØ¨Ø© Ù„Ø§Ø¨ØªÙˆØ¨ Ø¬Ù„Ø¯': {'price': 220, 'cost': 120, 'category': 'Ù…ÙƒØªØ¨ÙŠØ©', 'supplier': 'Ù…Ø­Ù„ÙŠ'},
    }
    
    data = []
    start_date = datetime(2023, 1, 1)
    end_date = datetime(2024, 1, 1)
    delta = end_date - start_date
    
    # Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ§Ø³Ù… ÙˆØ£Ø­Ø¯Ø§Ø« Ø®Ø§ØµØ©
    special_dates = {
        'Ø±Ù…Ø¶Ø§Ù†': ((datetime(2023, 3, 23), datetime(2023, 4, 21)), 2.5),  # Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª 250%
        'Ø¹ÙŠØ¯ Ø§Ù„ÙØ·Ø±': ((datetime(2023, 4, 22), datetime(2023, 4, 24)), 3.0),
        'Ø§Ù„Ø¬Ù…Ø¹Ø© Ø§Ù„Ø¨ÙŠØ¶Ø§Ø¡': ((datetime(2023, 11, 24), datetime(2023, 11, 26)), 4.0),
        'Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù…Ø¯Ø§Ø±Ø³': ((datetime(2023, 8, 20), datetime(2023, 9, 10)), 1.8),
        '11.11': ((datetime(2023, 11, 11), datetime(2023, 11, 11)), 3.5),
    }
    
    # ØªÙˆÙ„ÙŠØ¯ 3000 Ø·Ù„Ø¨ (Ø²ÙŠØ§Ø¯Ø© Ù…Ù† 2000)
    for i in range(3000):
        # Ø§Ø®ØªÙŠØ§Ø± ØªØ§Ø±ÙŠØ® Ø¹Ø´ÙˆØ§Ø¦ÙŠ
        random_days = random.randrange(delta.days)
        base_date = start_date + timedelta(days=random_days)
        
        # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…ÙˆØ§Ø³Ù… Ø§Ù„Ø®Ø§ØµØ©
        season_multiplier = 1.0
        for season, (date_range, multiplier) in special_dates.items():
            if date_range[0] <= base_date <= date_range[1]:
                season_multiplier = multiplier
                break
        
        # Ø£ÙˆØ²Ø§Ù† Ø§Ù„Ø³Ø§Ø¹Ø§Øª: Ø²ÙŠØ§Ø¯Ø© ÙÙŠ Ø§Ù„Ù…Ø³Ø§Ø¡ ÙˆØ§Ù„Ù„ÙŠÙ„
        hour_weights = [1]*6 + [2]*4 + [3]*4 + [5]*6 + [4]*3 + [2]*1
        hour = random.choices(range(24), weights=hour_weights, k=1)[0]
        date_time = base_date.replace(hour=hour, minute=random.randint(0, 59))
        
        # Ø£ÙˆØ²Ø§Ù† Ø£ÙŠØ§Ù… Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ (Ø§Ù„Ø®Ù…ÙŠØ³ ÙˆØ§Ù„Ø¬Ù…Ø¹Ø© Ø£Ø¹Ù„Ù‰)
        day_weight = 1.5 if date_time.weekday() in [3, 4] else 1.0
        
        # Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…Ø¹ Ø£ÙˆØ²Ø§Ù† ÙˆØ§Ù‚Ø¹ÙŠØ©
        prod_weights = [8, 7, 55, 45, 12, 20, 15, 65, 50, 22, 30, 28, 18, 10, 15]
        prod_name = random.choices(list(products_db.keys()), weights=prod_weights, k=1)[0]
        prod_info = products_db[prod_name]
        
        # Ø§Ù„ÙƒÙ…ÙŠØ© (Ù…Ø¹Ø¸Ù… Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ù‚Ø·Ø¹Ø© ÙˆØ§Ø­Ø¯Ø©)
        if season_multiplier > 2:  # ÙÙŠ Ø§Ù„Ù…ÙˆØ§Ø³Ù…ØŒ Ø§Ø­ØªÙ…Ø§Ù„ Ø´Ø±Ø§Ø¡ ÙƒÙ…ÙŠØ§Øª Ø£ÙƒØ¨Ø±
            qty = random.choices([1, 2, 3, 5], weights=[60, 25, 10, 5], k=1)[0]
        else:
            qty = random.choices([1, 2, 3], weights=[85, 12, 3], k=1)[0]
        
        # Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¨Ø§Ù„Øº
        total_sales = prod_info['price'] * qty
        total_cost = prod_info['cost'] * qty
        profit = total_sales - total_cost
        margin_pct = (profit / total_sales) * 100 if total_sales > 0 else 0
        
        # Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ÙˆØ±Ø¯ ÙˆØ§Ù„Ù…Ø¯ÙŠÙ†Ø©
        cities = ['Ø§Ù„Ø±ÙŠØ§Ø¶', 'Ø¬Ø¯Ø©', 'Ø§Ù„Ø¯Ù…Ø§Ù…', 'Ù…ÙƒØ©', 'Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©', 'Ø§Ù„Ø®Ø¨Ø±', 'Ø§Ù„Ø·Ø§Ø¦Ù']
        city_weights = [30, 25, 15, 10, 8, 7, 5]
        
        data.append({
            'Ø±Ù‚Ù…_Ø§Ù„Ø·Ù„Ø¨': f"ORD-{2000+i}",
            'Ø§Ù„ØªØ§Ø±ÙŠØ®_ÙˆØ§Ù„ÙˆÙ‚Øª': date_time,
            'Ø§Ù„Ù…Ù†ØªØ¬': prod_name,
            'Ø§Ù„ÙØ¦Ø©': prod_info['category'],
            'Ø§Ù„Ù…ÙˆØ±Ø¯': prod_info['supplier'],
            'Ø³Ø¹Ø±_Ø§Ù„ÙˆØ­Ø¯Ø©': prod_info['price'],
            'ØªÙƒÙ„ÙØ©_Ø§Ù„ÙˆØ­Ø¯Ø©': prod_info['cost'],
            'Ø§Ù„ÙƒÙ…ÙŠØ©': qty,
            'Ø¥Ø¬Ù…Ø§Ù„ÙŠ_Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª': total_sales,
            'Ø¥Ø¬Ù…Ø§Ù„ÙŠ_Ø§Ù„ØªÙƒÙ„ÙØ©': total_cost,
            'ØµØ§ÙÙŠ_Ø§Ù„Ø±Ø¨Ø­': profit,
            'Ù‡Ø§Ù…Ø´_Ø§Ù„Ø±Ø¨Ø­_%': margin_pct,
            'Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©': random.choices(cities, weights=city_weights, k=1)[0],
            'Ø§Ù„Ø³Ø§Ø¹Ø©': hour,
            'Ø§Ù„ÙŠÙˆÙ…': date_time.strftime('%A'),
            'Ø§Ù„Ø´Ù‡Ø±': date_time.month,
            'Ø§Ø³Ù…_Ø§Ù„Ø´Ù‡Ø±': date_time.strftime('%B'),
        })
    
    df = pd.DataFrame(data)
    
    # Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©
    df['Ø§Ù„ØªØ§Ø±ÙŠØ®'] = df['Ø§Ù„ØªØ§Ø±ÙŠØ®_ÙˆØ§Ù„ÙˆÙ‚Øª']  # Ø¥Ø¶Ø§ÙØ© Ø§Ø³Ù… Ù…Ø®ØªØµØ± Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙÙŠ AI functions
    df['Ø§Ù„Ø±Ø¨Ø¹'] = df['Ø§Ù„Ø´Ù‡Ø±'].apply(lambda x: f'Q{(x-1)//3 + 1}')
    df['Ù†Ù‡Ø§ÙŠØ©_Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹'] = df['Ø§Ù„ØªØ§Ø±ÙŠØ®_ÙˆØ§Ù„ÙˆÙ‚Øª'].dt.dayofweek.isin([4, 5])
    
    print(f"   âœ… ØªÙ… ØªÙˆÙ„ÙŠØ¯ {len(df):,} Ø·Ù„Ø¨ Ø´Ø±Ø§Ø¡")
    print(f"   âœ… Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª: {df['Ø§Ù„Ù…Ù†ØªØ¬'].nunique()}")
    print(f"   âœ… Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ©: {df['Ø§Ù„ØªØ§Ø±ÙŠØ®_ÙˆØ§Ù„ÙˆÙ‚Øª'].min().date()} Ø¥Ù„Ù‰ {df['Ø§Ù„ØªØ§Ø±ÙŠØ®_ÙˆØ§Ù„ÙˆÙ‚Øª'].max().date()}")
    
    return df


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# [2] Ø§Ù„Ù…Ø­Ù„Ù„ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠ Ø§Ù„Ù…ØªÙ‚Ø¯Ù… - Advanced Statistical Analyzer
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

def perform_advanced_analysis(df):
    """
    ÙŠØ¬Ø±ÙŠ ØªØ­Ù„ÙŠÙ„Ø§Øª Ø¥Ø­ØµØ§Ø¦ÙŠØ© Ø¹Ù…ÙŠÙ‚Ø©:
    - KPIs Ø±Ø¦ÙŠØ³ÙŠØ©
    - ØªØ­Ù„ÙŠÙ„ ABC
    - ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø§ØªØ¬Ø§Ù‡Ø§Øª Ø§Ù„Ø²Ù…Ù†ÙŠØ©
    - ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø±Ø¨Ø­ÙŠØ© Ø­Ø³Ø¨ Ø§Ù„ÙØ¦Ø§Øª
    """
    print("\n[2/8] ğŸ“Š Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©...")
    
    analysis = {}
    
    # === KPIs Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ===
    analysis['Ø¥Ø¬Ù…Ø§Ù„ÙŠ_Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª'] = df['Ø¥Ø¬Ù…Ø§Ù„ÙŠ_Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª'].sum()
    analysis['Ø¥Ø¬Ù…Ø§Ù„ÙŠ_Ø§Ù„ØªÙƒÙ„ÙØ©'] = df['Ø¥Ø¬Ù…Ø§Ù„ÙŠ_Ø§Ù„ØªÙƒÙ„ÙØ©'].sum()
    analysis['ØµØ§ÙÙŠ_Ø§Ù„Ø±Ø¨Ø­'] = df['ØµØ§ÙÙŠ_Ø§Ù„Ø±Ø¨Ø­'].sum()
    analysis['Ù‡Ø§Ù…Ø´_Ø§Ù„Ø±Ø¨Ø­_Ø§Ù„ÙƒÙ„ÙŠ'] = (analysis['ØµØ§ÙÙŠ_Ø§Ù„Ø±Ø¨Ø­'] / analysis['Ø¥Ø¬Ù…Ø§Ù„ÙŠ_Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª']) * 100
    analysis['Ø¹Ø¯Ø¯_Ø§Ù„Ø·Ù„Ø¨Ø§Øª'] = len(df)
    analysis['Ù…ØªÙˆØ³Ø·_Ù‚ÙŠÙ…Ø©_Ø§Ù„Ø·Ù„Ø¨'] = df['Ø¥Ø¬Ù…Ø§Ù„ÙŠ_Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª'].mean()
    analysis['Ù…ØªÙˆØ³Ø·_Ø§Ù„Ø±Ø¨Ø­_Ù„ÙƒÙ„_Ø·Ù„Ø¨'] = df['ØµØ§ÙÙŠ_Ø§Ù„Ø±Ø¨Ø­'].mean()
    
    # === ØªØ­Ù„ÙŠÙ„ ABC Ù„Ù„Ù…Ù†ØªØ¬Ø§Øª ===
    product_revenue = df.groupby('Ø§Ù„Ù…Ù†ØªØ¬')['Ø¥Ø¬Ù…Ø§Ù„ÙŠ_Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª'].sum().sort_values(ascending=False)
    product_revenue_cum = product_revenue.cumsum() / product_revenue.sum() * 100
    
    analysis['Ù…Ù†ØªØ¬Ø§Øª_A'] = product_revenue_cum[product_revenue_cum <= 80].index.tolist()
    analysis['Ù…Ù†ØªØ¬Ø§Øª_B'] = product_revenue_cum[(product_revenue_cum > 80) & (product_revenue_cum <= 95)].index.tolist()
    analysis['Ù…Ù†ØªØ¬Ø§Øª_C'] = product_revenue_cum[product_revenue_cum > 95].index.tolist()
    
    # === Ø£ÙØ¶Ù„ ÙˆØ£Ø³ÙˆØ£ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ===
    product_profit = df.groupby('Ø§Ù„Ù…Ù†ØªØ¬')['ØµØ§ÙÙŠ_Ø§Ù„Ø±Ø¨Ø­'].sum().sort_values(ascending=False)
    analysis['Ø£ÙØ¶Ù„_5_Ù…Ù†ØªØ¬Ø§Øª'] = product_profit.head(5).to_dict()
    analysis['Ø£Ø³ÙˆØ£_5_Ù…Ù†ØªØ¬Ø§Øª'] = product_profit.tail(5).to_dict()
    
    # === ØªØ­Ù„ÙŠÙ„ Ø§Ù„ÙØ¦Ø§Øª ===
    category_analysis = df.groupby('Ø§Ù„ÙØ¦Ø©').agg({
        'Ø¥Ø¬Ù…Ø§Ù„ÙŠ_Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª': 'sum',
        'ØµØ§ÙÙŠ_Ø§Ù„Ø±Ø¨Ø­': 'sum',
        'Ø§Ù„ÙƒÙ…ÙŠØ©': 'sum'
    }).sort_values('ØµØ§ÙÙŠ_Ø§Ù„Ø±Ø¨Ø­', ascending=False)
    
    category_analysis['Ù‡Ø§Ù…Ø´_Ø§Ù„Ø±Ø¨Ø­_%'] = (category_analysis['ØµØ§ÙÙŠ_Ø§Ù„Ø±Ø¨Ø­'] / category_analysis['Ø¥Ø¬Ù…Ø§Ù„ÙŠ_Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª']) * 100
    analysis['ØªØ­Ù„ÙŠÙ„_Ø§Ù„ÙØ¦Ø§Øª'] = category_analysis
    
    # === Ø£ÙØ¶Ù„ Ø§Ù„Ø£ÙˆÙ‚Ø§Øª Ù„Ù„Ø¨ÙŠØ¹ ===
    hourly_sales = df.groupby('Ø§Ù„Ø³Ø§Ø¹Ø©')['Ø¥Ø¬Ù…Ø§Ù„ÙŠ_Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª'].sum()
    analysis['Ø£ÙØ¶Ù„_Ø³Ø§Ø¹Ø©'] = hourly_sales.idxmax()
    analysis['Ø£Ø³ÙˆØ£_Ø³Ø§Ø¹Ø©'] = hourly_sales.idxmin()
    
    daily_sales = df.groupby('Ø§Ù„ÙŠÙˆÙ…')['Ø¥Ø¬Ù…Ø§Ù„ÙŠ_Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª'].sum()
    analysis['Ø£ÙØ¶Ù„_ÙŠÙˆÙ…'] = daily_sales.idxmax()
    
    # === ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…ÙˆØ§Ø³Ù… ===
    monthly_sales = df.groupby('Ø§Ø³Ù…_Ø§Ù„Ø´Ù‡Ø±')['Ø¥Ø¬Ù…Ø§Ù„ÙŠ_Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª'].sum()
    analysis['Ø£ÙØ¶Ù„_Ø´Ù‡Ø±'] = monthly_sales.idxmax()
    analysis['Ø£Ø³ÙˆØ£_Ø´Ù‡Ø±'] = monthly_sales.idxmin()
    
    # === ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ ===
    city_analysis = df.groupby('Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©').agg({
        'Ø¥Ø¬Ù…Ø§Ù„ÙŠ_Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª': 'sum',
        'Ø±Ù‚Ù…_Ø§Ù„Ø·Ù„Ø¨': 'count'
    }).sort_values('Ø¥Ø¬Ù…Ø§Ù„ÙŠ_Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª', ascending=False)
    analysis['Ø£ÙØ¶Ù„_Ù…Ø¯ÙŠÙ†Ø©'] = city_analysis.index[0]
    analysis['ØªØ­Ù„ÙŠÙ„_Ø§Ù„Ù…Ø¯Ù†'] = city_analysis
    
    # === Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªØ­ÙˆÙŠÙ„ ÙˆØ§Ù„Ø£Ø¯Ø§Ø¡ ===
    analysis['Ù…ØªÙˆØ³Ø·_Ø§Ù„Ù‚Ø·Ø¹_Ù„ÙƒÙ„_Ø·Ù„Ø¨'] = df['Ø§Ù„ÙƒÙ…ÙŠØ©'].mean()
    analysis['Ù…Ø¹Ø¯Ù„_Ø§Ù„Ø·Ù„Ø¨Ø§Øª_Ø§Ù„ÙŠÙˆÙ…ÙŠ'] = len(df) / 365
    
    print(f"   âœ… Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª: {analysis['Ø¥Ø¬Ù…Ø§Ù„ÙŠ_Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª']:,.0f} Ø±ÙŠØ§Ù„")
    print(f"   âœ… ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­: {analysis['ØµØ§ÙÙŠ_Ø§Ù„Ø±Ø¨Ø­']:,.0f} Ø±ÙŠØ§Ù„")
    print(f"   âœ… Ù‡Ø§Ù…Ø´ Ø§Ù„Ø±Ø¨Ø­: {analysis['Ù‡Ø§Ù…Ø´_Ø§Ù„Ø±Ø¨Ø­_Ø§Ù„ÙƒÙ„ÙŠ']:.2f}%")
    print(f"   âœ… Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø¨Ø§Øª: {analysis['Ø¹Ø¯Ø¯_Ø§Ù„Ø·Ù„Ø¨Ø§Øª']:,}")
    
    return analysis


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# [3] Ù…ÙˆÙ„Ø¯ Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ© Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ© - Advanced Visualizer
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

def create_advanced_visualizations(df, analysis):
    """
    ÙŠÙ†Ø´Ø¦ Ø±Ø³ÙˆÙ… Ø¨ÙŠØ§Ù†ÙŠØ© Ø§Ø­ØªØ±Ø§ÙÙŠØ© Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©:
    - Heatmap Ù„Ù„Ù…Ø¨ÙŠØ¹Ø§Øª
    - ABC Analysis
    - ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø§ØªØ¬Ø§Ù‡Ø§Øª
    - Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„ÙØ¦Ø§Øª
    - ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­
    """
    print("\n[3/8] ğŸ“ˆ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ© Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ©...")
    
    plots = []
    sns.set_style("whitegrid")
    
    # === 1. Ø®Ø±ÙŠØ·Ø© Ø­Ø±Ø§Ø±ÙŠØ© Ù„Ù„Ù…Ø¨ÙŠØ¹Ø§Øª (Ø§Ù„ÙŠÙˆÙ… Ã— Ø§Ù„Ø³Ø§Ø¹Ø©) ===
    plt.figure(figsize=(14, 7))
    pivot_table = df.pivot_table(
        index='Ø§Ù„ÙŠÙˆÙ…',
        columns='Ø§Ù„Ø³Ø§Ø¹Ø©',
        values='Ø¥Ø¬Ù…Ø§Ù„ÙŠ_Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª',
        aggfunc='sum'
    )
    
    days_order = ['Saturday', 'Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday']
    pivot_table = pivot_table.reindex(days_order)
    
    sns.heatmap(pivot_table, cmap='YlOrRd', linewidths=0.5, annot=False, fmt='.0f', cbar_kws={'label': 'Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª (Ø±ÙŠØ§Ù„)'})
    plt.title('Ø®Ø±ÙŠØ·Ø© Ø­Ø±Ø§Ø±ÙŠØ©: Ù…ØªÙ‰ ÙŠØ´ØªØ±ÙŠ Ø¹Ù…Ù„Ø§Ø¤ÙƒØŸ', fontsize=16, fontweight='bold', pad=20)
    plt.xlabel('Ø§Ù„Ø³Ø§Ø¹Ø©', fontsize=12)
    plt.ylabel('Ø§Ù„ÙŠÙˆÙ…', fontsize=12)
    plt.tight_layout()
    plt.savefig('chart_1_heatmap.png', dpi=150, bbox_inches='tight')
    plots.append('chart_1_heatmap.png')
    plt.close()
    print("   âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡: Ø®Ø±ÙŠØ·Ø© Ø­Ø±Ø§Ø±ÙŠØ© Ù„Ù„Ù…Ø¨ÙŠØ¹Ø§Øª")
    
    # === 2. ØªØ­Ù„ÙŠÙ„ ABC (Ø¨Ø§Ø±ÙŠØªÙˆ) - Ø£Ù‡Ù… Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ===
    plt.figure(figsize=(14, 7))
    product_profit = df.groupby('Ø§Ù„Ù…Ù†ØªØ¬')['ØµØ§ÙÙŠ_Ø§Ù„Ø±Ø¨Ø­'].sum().sort_values(ascending=False)
    cumulative_pct = product_profit.cumsum() / product_profit.sum() * 100
    
    fig, ax1 = plt.subplots(figsize=(14, 7))
    
    # Ø±Ø³Ù… Ø§Ù„Ø£Ø¹Ù…Ø¯Ø©
    bars = ax1.bar(range(len(product_profit)), product_profit.values, color='teal', alpha=0.7, label='Ø§Ù„Ø±Ø¨Ø­')
    ax1.set_ylabel('ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­ (Ø±ÙŠØ§Ù„)', fontsize=12, fontweight='bold')
    ax1.set_xlabel('Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª', fontsize=12)
    ax1.set_xticks(range(len(product_profit)))
    ax1.set_xticklabels(product_profit.index, rotation=45, ha='right')
    
    # Ø±Ø³Ù… Ø§Ù„Ù…Ù†Ø­Ù†Ù‰ Ø§Ù„ØªØ±Ø§ÙƒÙ…ÙŠ
    ax2 = ax1.twinx()
    line = ax2.plot(range(len(cumulative_pct)), cumulative_pct.values, color='red', marker='o', linewidth=2, markersize=6, label='Ù†Ø³Ø¨Ø© ØªØ±Ø§ÙƒÙ…ÙŠØ©')
    ax2.axhline(80, color='orange', linestyle='--', linewidth=2, label='Ø®Ø· 80%')
    ax2.set_ylabel('Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„ØªØ±Ø§ÙƒÙ…ÙŠØ© (%)', fontsize=12, fontweight='bold')
    ax2.set_ylim(0, 105)
    
    plt.title('ØªØ­Ù„ÙŠÙ„ ABC: Ù‚Ø§Ø¹Ø¯Ø© 80/20 - Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„ØªÙŠ ØªØ­Ù‚Ù‚ 80% Ù…Ù† Ø§Ù„Ø£Ø±Ø¨Ø§Ø­', fontsize=16, fontweight='bold', pad=20)
    
    # Ø¥Ø¶Ø§ÙØ© Legend
    lines1, labels1 = ax1.get_legend_handles_labels()
    lines2, labels2 = ax2.get_legend_handles_labels()
    ax1.legend(lines1 + lines2, labels1 + labels2, loc='upper right')
    
    plt.tight_layout()
    plt.savefig('chart_2_abc_analysis.png', dpi=150, bbox_inches='tight')
    plots.append('chart_2_abc_analysis.png')
    plt.close()
    print("   âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡: ØªØ­Ù„ÙŠÙ„ ABC (Ø¨Ø§Ø±ÙŠØªÙˆ)")
    
    # === 3. Ù…ØµÙÙˆÙØ© Ø§Ù„Ø­Ø¬Ù… vs Ø§Ù„Ø±Ø¨Ø­ÙŠØ© ===
    plt.figure(figsize=(12, 8))
    prod_stats = df.groupby('Ø§Ù„Ù…Ù†ØªØ¬').agg({
        'Ø§Ù„ÙƒÙ…ÙŠØ©': 'sum',
        'ØµØ§ÙÙŠ_Ø§Ù„Ø±Ø¨Ø­': 'mean',
        'Ø¥Ø¬Ù…Ø§Ù„ÙŠ_Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª': 'sum'
    }).reset_index()
    
    plt.scatter(prod_stats['Ø§Ù„ÙƒÙ…ÙŠØ©'], prod_stats['ØµØ§ÙÙŠ_Ø§Ù„Ø±Ø¨Ø­'], 
                s=prod_stats['Ø¥Ø¬Ù…Ø§Ù„ÙŠ_Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª']/50, alpha=0.6, c='purple', edgecolors='black')
    
    # Ø¥Ø¶Ø§ÙØ© Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
    for idx, row in prod_stats.iterrows():
        plt.annotate(row['Ø§Ù„Ù…Ù†ØªØ¬'], 
                    (row['Ø§Ù„ÙƒÙ…ÙŠØ©'], row['ØµØ§ÙÙŠ_Ø§Ù„Ø±Ø¨Ø­']),
                    fontsize=8, alpha=0.7, ha='right')
    
    plt.axhline(prod_stats['ØµØ§ÙÙŠ_Ø§Ù„Ø±Ø¨Ø­'].median(), color='red', linestyle='--', alpha=0.5, label='Ù…ØªÙˆØ³Ø· Ø§Ù„Ø±Ø¨Ø­ÙŠØ©')
    plt.axvline(prod_stats['Ø§Ù„ÙƒÙ…ÙŠØ©'].median(), color='blue', linestyle='--', alpha=0.5, label='Ù…ØªÙˆØ³Ø· Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª')
    
    plt.title('Ù…ØµÙÙˆÙØ© Ø§Ù„Ø­Ø¬Ù… vs Ø§Ù„Ø±Ø¨Ø­ÙŠØ© (Ø­Ø¬Ù… Ø§Ù„Ø¯Ø§Ø¦Ø±Ø© = Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª)', fontsize=16, fontweight='bold', pad=20)
    plt.xlabel('Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø¨Ø§Ø¹Ø©', fontsize=12)
    plt.ylabel('Ù…ØªÙˆØ³Ø· Ø§Ù„Ø±Ø¨Ø­ Ù„ÙƒÙ„ ÙˆØ­Ø¯Ø© (Ø±ÙŠØ§Ù„)', fontsize=12)
    plt.legend()
    plt.grid(True, alpha=0.3)
    plt.tight_layout()
    plt.savefig('chart_3_volume_profitability.png', dpi=150, bbox_inches='tight')
    plots.append('chart_3_volume_profitability.png')
    plt.close()
    print("   âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡: Ù…ØµÙÙˆÙØ© Ø§Ù„Ø­Ø¬Ù… vs Ø§Ù„Ø±Ø¨Ø­ÙŠØ©")
    
    # === 4. ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø§ØªØ¬Ø§Ù‡Ø§Øª Ø§Ù„Ø´Ù‡Ø±ÙŠØ© ===
    plt.figure(figsize=(14, 6))
    monthly_data = df.groupby(df['Ø§Ù„ØªØ§Ø±ÙŠØ®_ÙˆØ§Ù„ÙˆÙ‚Øª'].dt.to_period('M')).agg({
        'Ø¥Ø¬Ù…Ø§Ù„ÙŠ_Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª': 'sum',
        'ØµØ§ÙÙŠ_Ø§Ù„Ø±Ø¨Ø­': 'sum'
    })
    
    monthly_data.index = monthly_data.index.to_timestamp()
    
    fig, ax1 = plt.subplots(figsize=(14, 6))
    
    ax1.plot(monthly_data.index, monthly_data['Ø¥Ø¬Ù…Ø§Ù„ÙŠ_Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª'], color='blue', marker='o', linewidth=2, label='Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª')
    ax1.set_ylabel('Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª (Ø±ÙŠØ§Ù„)', fontsize=12, color='blue', fontweight='bold')
    ax1.tick_params(axis='y', labelcolor='blue')
    ax1.grid(True, alpha=0.3)
    
    ax2 = ax1.twinx()
    ax2.plot(monthly_data.index, monthly_data['ØµØ§ÙÙŠ_Ø§Ù„Ø±Ø¨Ø­'], color='green', marker='s', linewidth=2, label='Ø§Ù„Ø£Ø±Ø¨Ø§Ø­')
    ax2.set_ylabel('ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­ (Ø±ÙŠØ§Ù„)', fontsize=12, color='green', fontweight='bold')
    ax2.tick_params(axis='y', labelcolor='green')
    
    plt.title('Ø§Ù„Ø§ØªØ¬Ø§Ù‡Ø§Øª Ø§Ù„Ø´Ù‡Ø±ÙŠØ©: Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª ÙˆØ§Ù„Ø£Ø±Ø¨Ø§Ø­', fontsize=16, fontweight='bold', pad=20)
    
    lines1, labels1 = ax1.get_legend_handles_labels()
    lines2, labels2 = ax2.get_legend_handles_labels()
    ax1.legend(lines1 + lines2, labels1 + labels2, loc='upper left')
    
    plt.tight_layout()
    plt.savefig('chart_4_monthly_trends.png', dpi=150, bbox_inches='tight')
    plots.append('chart_4_monthly_trends.png')
    plt.close()
    print("   âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡: Ø§Ù„Ø§ØªØ¬Ø§Ù‡Ø§Øª Ø§Ù„Ø´Ù‡Ø±ÙŠØ©")
    
    # === 5. Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„ÙØ¦Ø§Øª ===
    plt.figure(figsize=(12, 7))
    category_data = df.groupby('Ø§Ù„ÙØ¦Ø©').agg({
        'Ø¥Ø¬Ù…Ø§Ù„ÙŠ_Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª': 'sum',
        'ØµØ§ÙÙŠ_Ø§Ù„Ø±Ø¨Ø­': 'sum',
        'Ø§Ù„ÙƒÙ…ÙŠØ©': 'sum'
    }).sort_values('ØµØ§ÙÙŠ_Ø§Ù„Ø±Ø¨Ø­', ascending=False)
    
    fig, (ax1, ax2) = plt.subplots(1, 2, figsize=(14, 6))
    
    # Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø£ÙˆÙ„: Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª
    ax1.barh(category_data.index, category_data['Ø¥Ø¬Ù…Ø§Ù„ÙŠ_Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª'], color='skyblue', edgecolor='black')
    ax1.set_xlabel('Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª (Ø±ÙŠØ§Ù„)', fontsize=12, fontweight='bold')
    ax1.set_title('Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø­Ø³Ø¨ Ø§Ù„ÙØ¦Ø©', fontsize=14, fontweight='bold')
    ax1.grid(axis='x', alpha=0.3)
    
    # Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø«Ø§Ù†ÙŠ: Ø§Ù„Ø£Ø±Ø¨Ø§Ø­
    ax2.barh(category_data.index, category_data['ØµØ§ÙÙŠ_Ø§Ù„Ø±Ø¨Ø­'], color='lightgreen', edgecolor='black')
    ax2.set_xlabel('ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­ (Ø±ÙŠØ§Ù„)', fontsize=12, fontweight='bold')
    ax2.set_title('Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ Ø­Ø³Ø¨ Ø§Ù„ÙØ¦Ø©', fontsize=14, fontweight='bold')
    ax2.grid(axis='x', alpha=0.3)
    
    plt.tight_layout()
    plt.savefig('chart_5_category_comparison.png', dpi=150, bbox_inches='tight')
    plots.append('chart_5_category_comparison.png')
    plt.close()
    print("   âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡: Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„ÙØ¦Ø§Øª")
    
    # === 6. ØªÙˆØ²ÙŠØ¹ Ù‡ÙˆØ§Ù…Ø´ Ø§Ù„Ø±Ø¨Ø­ ===
    plt.figure(figsize=(12, 6))
    plt.hist(df['Ù‡Ø§Ù…Ø´_Ø§Ù„Ø±Ø¨Ø­_%'], bins=30, color='coral', edgecolor='black', alpha=0.7)
    plt.axvline(df['Ù‡Ø§Ù…Ø´_Ø§Ù„Ø±Ø¨Ø­_%'].mean(), color='red', linestyle='--', linewidth=2, label=f'Ø§Ù„Ù…ØªÙˆØ³Ø·: {df["Ù‡Ø§Ù…Ø´_Ø§Ù„Ø±Ø¨Ø­_%"].mean():.1f}%')
    plt.axvline(df['Ù‡Ø§Ù…Ø´_Ø§Ù„Ø±Ø¨Ø­_%'].median(), color='blue', linestyle='--', linewidth=2, label=f'Ø§Ù„ÙˆØ³ÙŠØ·: {df["Ù‡Ø§Ù…Ø´_Ø§Ù„Ø±Ø¨Ø­_%"].median():.1f}%')
    plt.xlabel('Ù‡Ø§Ù…Ø´ Ø§Ù„Ø±Ø¨Ø­ (%)', fontsize=12, fontweight='bold')
    plt.ylabel('Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø¨Ø§Øª', fontsize=12, fontweight='bold')
    plt.title('ØªÙˆØ²ÙŠØ¹ Ù‡ÙˆØ§Ù…Ø´ Ø§Ù„Ø±Ø¨Ø­', fontsize=16, fontweight='bold', pad=20)
    plt.legend()
    plt.grid(axis='y', alpha=0.3)
    plt.tight_layout()
    plt.savefig('chart_6_margin_distribution.png', dpi=150, bbox_inches='tight')
    plots.append('chart_6_margin_distribution.png')
    plt.close()
    print("   âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡: ØªÙˆØ²ÙŠØ¹ Ù‡ÙˆØ§Ù…Ø´ Ø§Ù„Ø±Ø¨Ø­")
    
    # === 7. Ø§Ù„ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ ===
    plt.figure(figsize=(10, 7))
    city_sales = df.groupby('Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©')['Ø¥Ø¬Ù…Ø§Ù„ÙŠ_Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª'].sum().sort_values(ascending=True)
    
    plt.barh(city_sales.index, city_sales.values, color='mediumpurple', edgecolor='black')
    plt.xlabel('Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª (Ø±ÙŠØ§Ù„)', fontsize=12, fontweight='bold')
    plt.title('Ø§Ù„ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ Ù„Ù„Ù…Ø¨ÙŠØ¹Ø§Øª', fontsize=16, fontweight='bold', pad=20)
    plt.grid(axis='x', alpha=0.3)
    plt.tight_layout()
    plt.savefig('chart_7_geographic_distribution.png', dpi=150, bbox_inches='tight')
    plots.append('chart_7_geographic_distribution.png')
    plt.close()
    print("   âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡: Ø§Ù„ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ")
    
    # === 8. Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø­Ø³Ø¨ Ø§Ù„ÙŠÙˆÙ… ===
    plt.figure(figsize=(12, 6))
    daily_sales = df.groupby('Ø§Ù„ÙŠÙˆÙ…')['Ø¥Ø¬Ù…Ø§Ù„ÙŠ_Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª'].sum()
    days_order = ['Saturday', 'Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday']
    daily_sales = daily_sales.reindex(days_order)
    
    colors = ['#FF6B6B' if day in ['Thursday', 'Friday'] else '#4ECDC4' for day in daily_sales.index]
    plt.bar(range(len(daily_sales)), daily_sales.values, color=colors, edgecolor='black', alpha=0.8)
    plt.xticks(range(len(daily_sales)), daily_sales.index, rotation=45)
    plt.ylabel('Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª (Ø±ÙŠØ§Ù„)', fontsize=12, fontweight='bold')
    plt.title('Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø­Ø³Ø¨ Ø£ÙŠØ§Ù… Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹', fontsize=16, fontweight='bold', pad=20)
    plt.grid(axis='y', alpha=0.3)
    plt.tight_layout()
    plt.savefig('chart_8_daily_sales.png', dpi=150, bbox_inches='tight')
    plots.append('chart_8_daily_sales.png')
    plt.close()
    print("   âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡: Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø­Ø³Ø¨ Ø§Ù„ÙŠÙˆÙ…")
    
    print(f"\n   âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ {len(plots)} Ø±Ø³Ù… Ø¨ÙŠØ§Ù†ÙŠ Ø§Ø­ØªØ±Ø§ÙÙŠ")
    
    return plots


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# [4] Ù…Ø­Ø±Ùƒ Ø§Ù„ØªÙˆØµÙŠØ§Øª Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© - Strategic Recommendations
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

def generate_strategic_recommendations(df, analysis):
    """
    ÙŠÙˆÙ„Ø¯ ØªÙˆØµÙŠØ§Øª Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªÙ†ÙÙŠØ° Ø§Ù„ÙÙˆØ±ÙŠ
    """
    print("\n[4/8] ğŸ§  ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØªÙˆØµÙŠØ§Øª Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ©...")
    
    recommendations = {
        'Ø¹Ø§Ø¬Ù„Ø©': [],
        'Ù‚ØµÙŠØ±Ø©_Ø§Ù„Ù…Ø¯Ù‰': [],
        'Ø·ÙˆÙŠÙ„Ø©_Ø§Ù„Ù…Ø¯Ù‰': [],
        'ØªØ­Ø³ÙŠÙ†Ø§Øª_ØªØ´ØºÙŠÙ„ÙŠØ©': []
    }
    
    # === ØªÙˆØµÙŠØ§Øª Ø¹Ø§Ø¬Ù„Ø© ===
    
    # 1. ØªØ­Ù„ÙŠÙ„ Ù‡Ø§Ù…Ø´ Ø§Ù„Ø±Ø¨Ø­
    if analysis['Ù‡Ø§Ù…Ø´_Ø§Ù„Ø±Ø¨Ø­_Ø§Ù„ÙƒÙ„ÙŠ'] < 20:
        recommendations['Ø¹Ø§Ø¬Ù„Ø©'].append({
            'Ø§Ù„Ø¹Ù†ÙˆØ§Ù†': 'âš ï¸ Ù‡Ø§Ù…Ø´ Ø±Ø¨Ø­ Ù…Ù†Ø®ÙØ¶ Ø¬Ø¯Ø§Ù‹!',
            'Ø§Ù„ØªÙØµÙŠÙ„': f'Ù‡Ø§Ù…Ø´ Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ø­Ø§Ù„ÙŠ {analysis["Ù‡Ø§Ù…Ø´_Ø§Ù„Ø±Ø¨Ø­_Ø§Ù„ÙƒÙ„ÙŠ"]:.2f}% Ø£Ù‚Ù„ Ù…Ù† Ø§Ù„Ø­Ø¯ Ø§Ù„ØµØ­ÙŠ (20%)',
            'Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡': 'Ø²ÙŠØ§Ø¯Ø© Ø£Ø³Ø¹Ø§Ø± Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø¥ÙƒØ³Ø³ÙˆØ§Ø±Ø§Øª Ø¨Ù†Ø³Ø¨Ø© 12-15% ÙÙˆØ±Ø§Ù‹ØŒ ÙÙ‡ÙŠ ØªØ­Ù‚Ù‚ Ù‡ÙˆØ§Ù…Ø´ Ø±Ø¨Ø­ Ø¹Ø§Ù„ÙŠØ© Ø¬Ø¯Ø§Ù‹ ÙˆÙ„Ù† ÙŠØ¤Ø«Ø± Ø°Ù„Ùƒ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª',
            'Ø§Ù„ØªØ£Ø«ÙŠØ±_Ø§Ù„Ù…ØªÙˆÙ‚Ø¹': 'Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ Ø¨Ù†Ø³Ø¨Ø© 8-12% Ø¯ÙˆÙ† Ø§Ù„ØªØ£Ø«ÙŠØ± Ø¹Ù„Ù‰ Ø­Ø¬Ù… Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª'
        })
    elif analysis['Ù‡Ø§Ù…Ø´_Ø§Ù„Ø±Ø¨Ø­_Ø§Ù„ÙƒÙ„ÙŠ'] >= 20 and analysis['Ù‡Ø§Ù…Ø´_Ø§Ù„Ø±Ø¨Ø­_Ø§Ù„ÙƒÙ„ÙŠ'] < 30:
        recommendations['Ø¹Ø§Ø¬Ù„Ø©'].append({
            'Ø§Ù„Ø¹Ù†ÙˆØ§Ù†': 'âœ… Ù‡Ø§Ù…Ø´ Ø±Ø¨Ø­ ØµØ­ÙŠ',
            'Ø§Ù„ØªÙØµÙŠÙ„': f'Ù‡Ø§Ù…Ø´ Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ø­Ø§Ù„ÙŠ {analysis["Ù‡Ø§Ù…Ø´_Ø§Ù„Ø±Ø¨Ø­_Ø§Ù„ÙƒÙ„ÙŠ"]:.2f}% Ø¶Ù…Ù† Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„ØµØ­ÙŠ',
            'Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡': 'Ø£Ø¹Ø¯ Ø§Ø³ØªØ«Ù…Ø§Ø± 15% Ù…Ù† Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ ÙÙŠ Ø­Ù…Ù„Ø§Øª Ø¥Ø¹Ù„Ø§Ù†ÙŠØ© Ù…Ø³ØªÙ‡Ø¯ÙØ© Ù„Ù„Ù…Ù†ØªØ¬Ø§Øª Ø¹Ø§Ù„ÙŠØ© Ø§Ù„Ø·Ù„Ø¨',
            'Ø§Ù„ØªØ£Ø«ÙŠØ±_Ø§Ù„Ù…ØªÙˆÙ‚Ø¹': 'Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø¨Ù†Ø³Ø¨Ø© 20-30% Ø®Ù„Ø§Ù„ 3 Ø£Ø´Ù‡Ø±'
        })
    else:
        recommendations['Ø¹Ø§Ø¬Ù„Ø©'].append({
            'Ø§Ù„Ø¹Ù†ÙˆØ§Ù†': 'ğŸŒŸ Ù‡Ø§Ù…Ø´ Ø±Ø¨Ø­ Ù…Ù…ØªØ§Ø²!',
            'Ø§Ù„ØªÙØµÙŠÙ„': f'Ù‡Ø§Ù…Ø´ Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ø­Ø§Ù„ÙŠ {analysis["Ù‡Ø§Ù…Ø´_Ø§Ù„Ø±Ø¨Ø­_Ø§Ù„ÙƒÙ„ÙŠ"]:.2f}% Ù…Ù…ØªØ§Ø²',
            'Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡': 'Ø­Ø§ÙØ¸ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ø­Ø§Ù„ÙŠØ©ØŒ ÙˆØ±ÙƒØ² Ø¹Ù„Ù‰ Ø²ÙŠØ§Ø¯Ø© Ø­Ø¬Ù… Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ù…Ù† Ø®Ù„Ø§Ù„ Ø§Ù„ØªØ³ÙˆÙŠÙ‚ Ø§Ù„Ù…ÙƒØ«Ù',
            'Ø§Ù„ØªØ£Ø«ÙŠØ±_Ø§Ù„Ù…ØªÙˆÙ‚Ø¹': 'Ù…Ø¶Ø§Ø¹ÙØ© Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ Ø®Ù„Ø§Ù„ 6 Ø£Ø´Ù‡Ø± Ù…Ø¹ Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„Ù‡ÙˆØ§Ù…Ø´ Ø§Ù„Ø­Ø§Ù„ÙŠØ©'
        })
    
    # 2. Ø£ÙØ¶Ù„ ÙˆÙ‚Øª Ù„Ù„Ù†Ø´Ø±
    recommendations['Ø¹Ø§Ø¬Ù„Ø©'].append({
        'Ø§Ù„Ø¹Ù†ÙˆØ§Ù†': f'â° Ø£ÙØ¶Ù„ ÙˆÙ‚Øª Ù„Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª: {analysis["Ø£ÙØ¶Ù„_Ø³Ø§Ø¹Ø©"]}:00',
        'Ø§Ù„ØªÙØµÙŠÙ„': f'Ø°Ø±ÙˆØ© Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª ØªØ­Ø¯Ø« ÙÙŠ Ø§Ù„Ø³Ø§Ø¹Ø© {analysis["Ø£ÙØ¶Ù„_Ø³Ø§Ø¹Ø©"]}:00',
        'Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡': f'Ø¬Ø¯ÙˆÙ„Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª Ø¹Ù„Ù‰ ØªÙˆÙŠØªØ±/Ø³Ù†Ø§Ø¨/ØªÙŠÙƒ ØªÙˆÙƒ ÙÙŠ Ø§Ù„Ø³Ø§Ø¹Ø© {analysis["Ø£ÙØ¶Ù„_Ø³Ø§Ø¹Ø©"]-1}:00 Ù„Ø¬Ø°Ø¨ Ø§Ù„Ù…ÙˆØ¬Ø©',
        'Ø§Ù„ØªØ£Ø«ÙŠØ±_Ø§Ù„Ù…ØªÙˆÙ‚Ø¹': 'Ø²ÙŠØ§Ø¯Ø© Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªÙØ§Ø¹Ù„ Ø¨Ù†Ø³Ø¨Ø© 35-50%'
    })
    
    # 3. Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø®Ø§Ø³Ø±Ø©
    worst_products = list(analysis['Ø£Ø³ÙˆØ£_5_Ù…Ù†ØªØ¬Ø§Øª'].keys())
    if worst_products:
        recommendations['Ø¹Ø§Ø¬Ù„Ø©'].append({
            'Ø§Ù„Ø¹Ù†ÙˆØ§Ù†': f'ğŸ—‘ï¸ ØªØ®Ù„Øµ Ù…Ù† Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ø®Ø§Ù…Ù„: {worst_products[0]}',
            'Ø§Ù„ØªÙØµÙŠÙ„': f'Ø§Ù„Ù…Ù†ØªØ¬ "{worst_products[0]}" ÙŠØ­Ù‚Ù‚ Ø£Ù‚Ù„ Ø±Ø¨Ø­',
            'Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡': 'Ø§Ø±Ø¨Ø·Ù‡ ÙƒÙ‡Ø¯ÙŠØ© Ù…Ø¬Ø§Ù†ÙŠØ© Ù…Ø¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø¹Ø§Ù„ÙŠØ© Ø§Ù„Ø³Ø¹Ø± Ù„ØªØµØ±ÙŠÙ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†',
            'Ø§Ù„ØªØ£Ø«ÙŠØ±_Ø§Ù„Ù…ØªÙˆÙ‚Ø¹': 'ØªØµÙÙŠØ© Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ÙˆØ²ÙŠØ§Ø¯Ø© Ø¬Ø§Ø°Ø¨ÙŠØ© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©'
        })
    
    # === ØªÙˆØµÙŠØ§Øª Ù‚ØµÙŠØ±Ø© Ø§Ù„Ù…Ø¯Ù‰ (1-3 Ø£Ø´Ù‡Ø±) ===
    
    # 1. Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„ÙØ¦Ø© A
    recommendations['Ù‚ØµÙŠØ±Ø©_Ø§Ù„Ù…Ø¯Ù‰'].append({
        'Ø§Ù„Ø¹Ù†ÙˆØ§Ù†': f'ğŸ“¦ Ø±ÙƒØ² Ø¹Ù„Ù‰ Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„ÙØ¦Ø© A ({len(analysis["Ù…Ù†ØªØ¬Ø§Øª_A"])} Ù…Ù†ØªØ¬Ø§Øª)',
        'Ø§Ù„ØªÙØµÙŠÙ„': 'Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ØªØ­Ù‚Ù‚ 80% Ù…Ù† Ø§Ù„Ø£Ø±Ø¨Ø§Ø­',
        'Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡': f'Ø²Ø¯ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ù…Ù†: {", ".join(analysis["Ù…Ù†ØªØ¬Ø§Øª_A"][:3])}ØŒ ÙˆØ®ØµØµ Ù„Ù‡Ø§ 70% Ù…Ù† Ù…ÙŠØ²Ø§Ù†ÙŠØ© Ø§Ù„ØªØ³ÙˆÙŠÙ‚',
        'Ø§Ù„ØªØ£Ø«ÙŠØ±_Ø§Ù„Ù…ØªÙˆÙ‚Ø¹': 'Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ Ø¨Ù†Ø³Ø¨Ø© 25-35% Ø®Ù„Ø§Ù„ Ø´Ù‡Ø±ÙŠÙ†'
    })
    
    # 2. Ø£ÙØ¶Ù„ Ø§Ù„Ø£ÙŠØ§Ù…
    recommendations['Ù‚ØµÙŠØ±Ø©_Ø§Ù„Ù…Ø¯Ù‰'].append({
        'Ø§Ù„Ø¹Ù†ÙˆØ§Ù†': f'ğŸ“… Ø§Ø³ØªØºÙ„ ÙŠÙˆÙ… {analysis["Ø£ÙØ¶Ù„_ÙŠÙˆÙ…"]}',
        'Ø§Ù„ØªÙØµÙŠÙ„': f'ÙŠÙˆÙ… {analysis["Ø£ÙØ¶Ù„_ÙŠÙˆÙ…"]} ÙŠØ­Ù‚Ù‚ Ø£Ø¹Ù„Ù‰ Ù…Ø¨ÙŠØ¹Ø§Øª',
        'Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡': f'Ø£Ø·Ù„Ù‚ Ø¹Ø±ÙˆØ¶ ÙˆÙƒÙˆØ¨ÙˆÙ†Ø§Øª Ø®Ø§ØµØ© ÙƒÙ„ ÙŠÙˆÙ… {analysis["Ø£ÙØ¶Ù„_ÙŠÙˆÙ…"]}',
        'Ø§Ù„ØªØ£Ø«ÙŠØ±_Ø§Ù„Ù…ØªÙˆÙ‚Ø¹': 'Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ… Ø¨Ù†Ø³Ø¨Ø© 40-60%'
    })
    
    # 3. Ø§Ù„Ù…ÙˆØ§Ø³Ù…
    recommendations['Ù‚ØµÙŠØ±Ø©_Ø§Ù„Ù…Ø¯Ù‰'].append({
        'Ø§Ù„Ø¹Ù†ÙˆØ§Ù†': f'ğŸ¯ Ø§Ø³ØªØ¹Ø¯ Ù…Ø³Ø¨Ù‚Ø§Ù‹ Ù„Ø´Ù‡Ø± {analysis["Ø£ÙØ¶Ù„_Ø´Ù‡Ø±"]}',
        'Ø§Ù„ØªÙØµÙŠÙ„': f'Ø´Ù‡Ø± {analysis["Ø£ÙØ¶Ù„_Ø´Ù‡Ø±"]} ÙŠØ­Ù‚Ù‚ Ø£Ø¹Ù„Ù‰ Ù…Ø¨ÙŠØ¹Ø§Øª Ø³Ù†ÙˆÙŠØ§Ù‹',
        'Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡': 'Ø²Ø¯ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ù‚Ø¨Ù„ Ø§Ù„Ù…ÙˆØ³Ù… Ø¨Ø´Ù‡Ø±ÙŠÙ†ØŒ ÙˆØ£Ø·Ù„Ù‚ Ø­Ù…Ù„Ø© ØªØ³ÙˆÙŠÙ‚ÙŠØ© Ù‚Ø¨Ù„ 3 Ø£Ø³Ø§Ø¨ÙŠØ¹',
        'Ø§Ù„ØªØ£Ø«ÙŠØ±_Ø§Ù„Ù…ØªÙˆÙ‚Ø¹': 'Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„Ù…ÙˆØ³Ù…ÙŠØ© Ø¨Ù†Ø³Ø¨Ø© 100-150%'
    })
    
    # === ØªÙˆØµÙŠØ§Øª Ø·ÙˆÙŠÙ„Ø© Ø§Ù„Ù…Ø¯Ù‰ (6-12 Ø´Ù‡Ø±) ===
    
    # 1. ØªÙˆØ³Ø¹ Ø¬ØºØ±Ø§ÙÙŠ
    recommendations['Ø·ÙˆÙŠÙ„Ø©_Ø§Ù„Ù…Ø¯Ù‰'].append({
        'Ø§Ù„Ø¹Ù†ÙˆØ§Ù†': f'ğŸŒ ØªÙˆØ³Ø¹ ÙÙŠ Ù…Ø¯ÙŠÙ†Ø© {analysis["Ø£ÙØ¶Ù„_Ù…Ø¯ÙŠÙ†Ø©"]}',
        'Ø§Ù„ØªÙØµÙŠÙ„': f'{analysis["Ø£ÙØ¶Ù„_Ù…Ø¯ÙŠÙ†Ø©"]} ØªØ­Ù‚Ù‚ Ø£Ø¹Ù„Ù‰ Ù…Ø¨ÙŠØ¹Ø§Øª',
        'Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡': 'Ø§ÙØªØ­ Ù…Ø³ØªÙˆØ¯Ø¹ ØµØºÙŠØ± Ø£Ùˆ Ø§ØªÙÙ‚ Ù…Ø¹ Ø´Ø±ÙƒØ© Ø´Ø­Ù† Ù…Ø­Ù„ÙŠØ© Ù„ØªÙ‚Ù„ÙŠÙ„ ÙˆÙ‚Øª Ø§Ù„ØªÙˆØµÙŠÙ„',
        'Ø§Ù„ØªØ£Ø«ÙŠØ±_Ø§Ù„Ù…ØªÙˆÙ‚Ø¹': 'Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø¨Ù†Ø³Ø¨Ø© 80-120%'
    })
    
    # 2. ØªÙ†ÙˆÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
    top_category = analysis['ØªØ­Ù„ÙŠÙ„_Ø§Ù„ÙØ¦Ø§Øª'].index[0]
    recommendations['Ø·ÙˆÙŠÙ„Ø©_Ø§Ù„Ù…Ø¯Ù‰'].append({
        'Ø§Ù„Ø¹Ù†ÙˆØ§Ù†': f'ğŸ›’ ÙˆØ³Ø¹ ØªØ´ÙƒÙŠÙ„Ø© ÙØ¦Ø© "{top_category}"',
        'Ø§Ù„ØªÙØµÙŠÙ„': f'ÙØ¦Ø© "{top_category}" Ù‡ÙŠ Ø§Ù„Ø£Ø¹Ù„Ù‰ Ø±Ø¨Ø­Ø§Ù‹',
        'Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡': 'Ø£Ø¶Ù 5-7 Ù…Ù†ØªØ¬Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© ÙÙŠ Ù†ÙØ³ Ø§Ù„ÙØ¦Ø© Ù…Ø¹ Ù…ÙˆØ±Ø¯ÙŠÙ† Ù…Ø®ØªÙ„ÙÙŠÙ†',
        'Ø§Ù„ØªØ£Ø«ÙŠØ±_Ø§Ù„Ù…ØªÙˆÙ‚Ø¹': 'Ø²ÙŠØ§Ø¯Ø© Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ Ø¨Ù†Ø³Ø¨Ø© 30-50%'
    })
    
    # 3. Ø¨Ø±Ù†Ø§Ù…Ø¬ ÙˆÙ„Ø§Ø¡
    recommendations['Ø·ÙˆÙŠÙ„Ø©_Ø§Ù„Ù…Ø¯Ù‰'].append({
        'Ø§Ù„Ø¹Ù†ÙˆØ§Ù†': 'ğŸ’ Ø£Ø·Ù„Ù‚ Ø¨Ø±Ù†Ø§Ù…Ø¬ ÙˆÙ„Ø§Ø¡ Ù„Ù„Ø¹Ù…Ù„Ø§Ø¡',
        'Ø§Ù„ØªÙØµÙŠÙ„': f'Ù…ØªÙˆØ³Ø· Ù‚ÙŠÙ…Ø© Ø§Ù„Ø·Ù„Ø¨ {analysis["Ù…ØªÙˆØ³Ø·_Ù‚ÙŠÙ…Ø©_Ø§Ù„Ø·Ù„Ø¨"]:.0f} Ø±ÙŠØ§Ù„',
        'Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡': 'Ù…Ù†Ø­ Ù†Ù‚Ø§Ø· ÙˆÙ„Ø§Ø¡ Ø¹Ù†Ø¯ ÙƒÙ„ Ø¹Ù…Ù„ÙŠØ© Ø´Ø±Ø§Ø¡ (1 Ù†Ù‚Ø·Ø© = 1 Ø±ÙŠØ§Ù„)ØŒ ÙˆØ§Ø³ØªØ¨Ø¯Ø§Ù„Ù‡Ø§ Ø¨Ø®ØµÙˆÙ…Ø§Øª',
        'Ø§Ù„ØªØ£Ø«ÙŠØ±_Ø§Ù„Ù…ØªÙˆÙ‚Ø¹': 'Ø²ÙŠØ§Ø¯Ø© Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„Ù…ØªÙƒØ±Ø±ÙŠÙ† Ø¨Ù†Ø³Ø¨Ø© 60-80%'
    })
    
    # === ØªØ­Ø³ÙŠÙ†Ø§Øª ØªØ´ØºÙŠÙ„ÙŠØ© ===
    
    # 1. Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
    recommendations['ØªØ­Ø³ÙŠÙ†Ø§Øª_ØªØ´ØºÙŠÙ„ÙŠØ©'].append({
        'Ø§Ù„Ø¹Ù†ÙˆØ§Ù†': 'ğŸ“Š Ø£ØªÙ…ØªØ© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†',
        'Ø§Ù„ØªÙØµÙŠÙ„': 'ØªØ¬Ù†Ø¨ Ù†ÙØ§Ø° Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ù„Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø±Ø§Ø¨Ø­Ø©',
        'Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡': 'Ø§Ø³ØªØ®Ø¯Ù… Ù†Ø¸Ø§Ù… ØªÙ†Ø¨ÙŠÙ‡ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù†Ø¯Ù…Ø§ ÙŠÙ†Ø®ÙØ¶ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø¹Ù† Ø­Ø¯ Ù…Ø¹ÙŠÙ†',
        'Ø§Ù„ØªØ£Ø«ÙŠØ±_Ø§Ù„Ù…ØªÙˆÙ‚Ø¹': 'ØªÙ‚Ù„ÙŠÙ„ Ø®Ø³Ø§Ø¦Ø± Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø¨Ø³Ø¨Ø¨ Ù†ÙØ§Ø° Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø¨Ù†Ø³Ø¨Ø© 90%'
    })
    
    # 2. ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø´Ø­Ù†
    recommendations['ØªØ­Ø³ÙŠÙ†Ø§Øª_ØªØ´ØºÙŠÙ„ÙŠØ©'].append({
        'Ø§Ù„Ø¹Ù†ÙˆØ§Ù†': 'ğŸšš Ø­Ø³Ù‘Ù† Ø³Ø±Ø¹Ø© Ø§Ù„Ø´Ø­Ù†',
        'Ø§Ù„ØªÙØµÙŠÙ„': 'Ø§Ù„Ø´Ø­Ù† Ø§Ù„Ø³Ø±ÙŠØ¹ ÙŠØ²ÙŠØ¯ Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªØ­ÙˆÙŠÙ„',
        'Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡': 'Ø§ØªÙÙ‚ Ù…Ø¹ Ø´Ø±ÙƒØªÙŠ Ø´Ø­Ù† (ÙˆØ§Ø­Ø¯Ø© Ø±Ø¦ÙŠØ³ÙŠØ© + ÙˆØ§Ø­Ø¯Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©) Ù„Ø¶Ù…Ø§Ù† Ø§Ù„ØªÙˆØµÙŠÙ„ Ø®Ù„Ø§Ù„ 48 Ø³Ø§Ø¹Ø©',
        'Ø§Ù„ØªØ£Ø«ÙŠØ±_Ø§Ù„Ù…ØªÙˆÙ‚Ø¹': 'Ø²ÙŠØ§Ø¯Ø© Ø±Ø¶Ø§ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ÙˆØªÙ‚Ù„ÙŠÙ„ Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¥Ù„ØºØ§Ø¡ Ø¨Ù†Ø³Ø¨Ø© 40%'
    })
    
    # 3. ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ù†Ø§ÙØ³ÙŠÙ†
    recommendations['ØªØ­Ø³ÙŠÙ†Ø§Øª_ØªØ´ØºÙŠÙ„ÙŠØ©'].append({
        'Ø§Ù„Ø¹Ù†ÙˆØ§Ù†': 'ğŸ” Ø±Ø§Ù‚Ø¨ Ø§Ù„Ù…Ù†Ø§ÙØ³ÙŠÙ† Ø£Ø³Ø¨ÙˆØ¹ÙŠØ§Ù‹',
        'Ø§Ù„ØªÙØµÙŠÙ„': 'Ø§Ù„Ø£Ø³Ø¹Ø§Ø± ÙˆØ§Ù„Ø¹Ø±ÙˆØ¶ ØªØªØºÙŠØ± Ø¨Ø³Ø±Ø¹Ø©',
        'Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡': 'Ø®ØµØµ 30 Ø¯Ù‚ÙŠÙ‚Ø© Ø£Ø³Ø¨ÙˆØ¹ÙŠØ§Ù‹ Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ù…Ù†Ø§ÙØ³ÙŠÙ† Ø¹Ù„Ù‰ Ù†ÙØ³ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª',
        'Ø§Ù„ØªØ£Ø«ÙŠØ±_Ø§Ù„Ù…ØªÙˆÙ‚Ø¹': 'Ø§Ù„Ø¨Ù‚Ø§Ø¡ ØªÙ†Ø§ÙØ³ÙŠØ§Ù‹ ÙˆØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ø¨Ø³Ø±Ø¹Ø©'
    })
    
    print(f"   âœ… ØªÙ… ØªÙˆÙ„ÙŠØ¯ {sum(len(v) for v in recommendations.values())} ØªÙˆØµÙŠØ© Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ©")
    
    return recommendations


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# [5] Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø© - Advanced KPIs
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

def calculate_advanced_kpis(df, analysis):
    """
    ÙŠØ­Ø³Ø¨ Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©
    """
    print("\n[5/8] ğŸ¯ Ø­Ø³Ø§Ø¨ Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©...")
    
    kpis = {}
    
    # === Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª ===
    kpis['Ø¥Ø¬Ù…Ø§Ù„ÙŠ_Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª'] = analysis['Ø¥Ø¬Ù…Ø§Ù„ÙŠ_Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª']
    kpis['Ù†Ù…Ùˆ_Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª_Ø§Ù„Ø´Ù‡Ø±ÙŠ'] = 'ØªØ­Ù„ÙŠÙ„ ÙŠØªØ·Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª ØªØ§Ø±ÙŠØ®ÙŠØ© Ø£Ø·ÙˆÙ„'
    
    # === Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø±Ø¨Ø­ÙŠØ© ===
    kpis['Ø¥Ø¬Ù…Ø§Ù„ÙŠ_Ø§Ù„Ø£Ø±Ø¨Ø§Ø­'] = analysis['ØµØ§ÙÙŠ_Ø§Ù„Ø±Ø¨Ø­']
    kpis['Ù‡Ø§Ù…Ø´_Ø§Ù„Ø±Ø¨Ø­_Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ_%'] = analysis['Ù‡Ø§Ù…Ø´_Ø§Ù„Ø±Ø¨Ø­_Ø§Ù„ÙƒÙ„ÙŠ']
    kpis['Ø§Ù„Ø±Ø¨Ø­_Ù„ÙƒÙ„_Ø·Ù„Ø¨'] = analysis['Ù…ØªÙˆØ³Ø·_Ø§Ù„Ø±Ø¨Ø­_Ù„ÙƒÙ„_Ø·Ù„Ø¨']
    kpis['ROI_Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª_%'] = 'ÙŠØªØ·Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¥Ù†ÙØ§Ù‚ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†ÙŠ'
    
    # === Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ ===
    kpis['Ù…ØªÙˆØ³Ø·_Ù‚ÙŠÙ…Ø©_Ø§Ù„Ø·Ù„Ø¨_AOV'] = analysis['Ù…ØªÙˆØ³Ø·_Ù‚ÙŠÙ…Ø©_Ø§Ù„Ø·Ù„Ø¨']
    kpis['Ø¹Ø¯Ø¯_Ø§Ù„Ø·Ù„Ø¨Ø§Øª_Ø§Ù„ÙƒÙ„ÙŠ'] = analysis['Ø¹Ø¯Ø¯_Ø§Ù„Ø·Ù„Ø¨Ø§Øª']
    kpis['Ù…Ø¹Ø¯Ù„_Ø§Ù„Ø·Ù„Ø¨Ø§Øª_Ø§Ù„ÙŠÙˆÙ…ÙŠ'] = analysis['Ù…Ø¹Ø¯Ù„_Ø§Ù„Ø·Ù„Ø¨Ø§Øª_Ø§Ù„ÙŠÙˆÙ…ÙŠ']
    
    # === Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ===
    kpis['Ù…Ø¹Ø¯Ù„_Ø¯ÙˆØ±Ø§Ù†_Ø§Ù„Ù…Ø®Ø²ÙˆÙ†'] = 'ÙŠØªØ·Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø®Ø²ÙˆÙ†'
    kpis['Ù†Ø³Ø¨Ø©_Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª_Ø§Ù„Ø±Ø§ÙƒØ¯Ø©'] = len(analysis['Ù…Ù†ØªØ¬Ø§Øª_C']) / (len(analysis['Ù…Ù†ØªØ¬Ø§Øª_A']) + len(analysis['Ù…Ù†ØªØ¬Ø§Øª_B']) + len(analysis['Ù…Ù†ØªØ¬Ø§Øª_C'])) * 100
    
    # === Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„ØªØ´ØºÙŠÙ„ ===
    kpis['Ù…ØªÙˆØ³Ø·_Ø§Ù„Ù‚Ø·Ø¹_Ù„ÙƒÙ„_Ø·Ù„Ø¨'] = analysis['Ù…ØªÙˆØ³Ø·_Ø§Ù„Ù‚Ø·Ø¹_Ù„ÙƒÙ„_Ø·Ù„Ø¨']
    kpis['Ù…Ø¹Ø¯Ù„_Ø§Ù„ØªØ­ÙˆÙŠÙ„'] = 'ÙŠØªØ·Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø²ÙˆØ§Ø±'
    
    # === Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø³ÙˆÙ‚ ===
    kpis['Ø§Ù„Ø­ØµØ©_Ø§Ù„Ø³ÙˆÙ‚ÙŠØ©'] = 'ÙŠØªØ·Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ'
    kpis['Ù…Ø¹Ø¯Ù„_Ø§Ù„Ù†Ù…Ùˆ'] = 'ÙŠØªØ·Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª ØªØ§Ø±ÙŠØ®ÙŠØ©'
    
    print(f"   âœ… ØªÙ… Ø­Ø³Ø§Ø¨ {len([v for v in kpis.values() if not isinstance(v, str) or not v.startswith('ÙŠØªØ·Ù„Ø¨')])} Ù…Ø¤Ø´Ø± Ø±Ø¦ÙŠØ³ÙŠ")
    
    return kpis


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# [6] AI-POWERED FEATURES - Ù…ÙŠØ²Ø§Øª Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

def ai_sales_forecasting(df):
    """
    Ø§Ù„ØªÙ†Ø¨Ø¤ Ø¨Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ÙŠØ© Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ
    Predicts future sales using machine learning
    """
    if not ML_AVAILABLE:
        return {'status': 'ML_NOT_AVAILABLE', 'predictions': []}
    
    print("\n[AI-1/6] ğŸ¤– Ø§Ù„ØªÙ†Ø¨Ø¤ Ø¨Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ...")
    
    try:
        # Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªÙ†Ø¨Ø¤
        daily_sales = df.groupby(df['Ø§Ù„ØªØ§Ø±ÙŠØ®'].dt.date).agg({
            'Ø¥Ø¬Ù…Ø§Ù„ÙŠ_Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª': 'sum',
            'Ø¥Ø¬Ù…Ø§Ù„ÙŠ_Ø§Ù„ØªÙƒÙ„ÙØ©': 'sum',
            'ØµØ§ÙÙŠ_Ø§Ù„Ø±Ø¨Ø­': 'sum'
        }).reset_index()
        
        daily_sales['Ø§Ù„ÙŠÙˆÙ…_Ø§Ù„Ø±Ù‚Ù…ÙŠ'] = range(len(daily_sales))
        daily_sales['Ø§Ù„ÙŠÙˆÙ…_ÙÙŠ_Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹'] = pd.to_datetime(daily_sales['Ø§Ù„ØªØ§Ø±ÙŠØ®']).dt.dayofweek
        daily_sales['Ø§Ù„ÙŠÙˆÙ…_ÙÙŠ_Ø§Ù„Ø´Ù‡Ø±'] = pd.to_datetime(daily_sales['Ø§Ù„ØªØ§Ø±ÙŠØ®']).dt.day
        
        # ØªÙ‚Ø³ÙŠÙ… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        X = daily_sales[['Ø§Ù„ÙŠÙˆÙ…_Ø§Ù„Ø±Ù‚Ù…ÙŠ', 'Ø§Ù„ÙŠÙˆÙ…_ÙÙŠ_Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹', 'Ø§Ù„ÙŠÙˆÙ…_ÙÙŠ_Ø§Ù„Ø´Ù‡Ø±']]
        y = daily_sales['Ø¥Ø¬Ù…Ø§Ù„ÙŠ_Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª']
        
        # ØªØ¯Ø±ÙŠØ¨ Ù†Ù…ÙˆØ°Ø¬ Random Forest
        model = RandomForestRegressor(n_estimators=100, random_state=42, max_depth=10)
        model.fit(X, y)
        
        # Ø§Ù„ØªÙ†Ø¨Ø¤ Ù„Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù€ 30 Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©
        last_day = daily_sales['Ø§Ù„ÙŠÙˆÙ…_Ø§Ù„Ø±Ù‚Ù…ÙŠ'].max()
        future_days = pd.DataFrame({
            'Ø§Ù„ÙŠÙˆÙ…_Ø§Ù„Ø±Ù‚Ù…ÙŠ': range(last_day + 1, last_day + 31),
            'Ø§Ù„ÙŠÙˆÙ…_ÙÙŠ_Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹': [(last_day + i) % 7 for i in range(1, 31)],
            'Ø§Ù„ÙŠÙˆÙ…_ÙÙŠ_Ø§Ù„Ø´Ù‡Ø±': [(i % 30) + 1 for i in range(1, 31)]
        })
        
        predictions = model.predict(future_days)
        
        # Ø­Ø³Ø§Ø¨ Ø¯Ù‚Ø© Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
        y_pred = model.predict(X)
        mae = mean_absolute_error(y, y_pred)
        r2 = r2_score(y, y_pred)
        
        print(f"   âœ… ØªÙ… ØªØ¯Ø±ÙŠØ¨ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªÙ†Ø¨Ø¤ Ø¨Ø¯Ù‚Ø©: {r2*100:.2f}%")
        print(f"   ğŸ“ˆ Ù…ØªÙˆØ³Ø· Ø§Ù„Ø®Ø·Ø£ Ø§Ù„Ù…Ø·Ù„Ù‚: {mae:,.0f} Ø±ÙŠØ§Ù„")
        print(f"   ğŸ”® Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø© Ù„Ù„Ø´Ù‡Ø± Ø§Ù„Ù‚Ø§Ø¯Ù…: {predictions.sum():,.0f} Ø±ÙŠØ§Ù„")
        
        return {
            'status': 'success',
            'predictions': predictions.tolist(),
            'accuracy_r2': float(r2),
            'mae': float(mae),
            'total_predicted': float(predictions.sum()),
            'daily_average': float(predictions.mean())
        }
    except Exception as e:
        logging.error(f"Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªÙ†Ø¨Ø¤ Ø¨Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª: {e}")
        return {'status': 'error', 'message': str(e)}


def ai_customer_segmentation(df):
    """
    ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ© K-Means
    Customer segmentation using AI clustering
    """
    if not ML_AVAILABLE:
        return {'status': 'ML_NOT_AVAILABLE', 'segments': []}
    
    print("\n[AI-2/6] ğŸ‘¥ ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„Ø°ÙƒÙŠ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… AI...")
    
    try:
        # Ø­Ø³Ø§Ø¨ Ù…Ù‚Ø§ÙŠÙŠØ³ RFM Ù„ÙƒÙ„ Ù…Ø¯ÙŠÙ†Ø© (ÙƒØ¨Ø¯ÙŠÙ„ Ù„Ù„Ø¹Ù…Ù„Ø§Ø¡)
        rfm_data = df.groupby('Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©').agg({
            'Ø§Ù„ØªØ§Ø±ÙŠØ®': lambda x: (datetime.now() - x.max()).days,  # Recency
            'Ø±Ù‚Ù…_Ø§Ù„Ø·Ù„Ø¨': 'count',  # Frequency
            'Ø¥Ø¬Ù…Ø§Ù„ÙŠ_Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª': 'sum'  # Monetary
        }).reset_index()
        
        rfm_data.columns = ['Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©', 'Ø§Ù„Ø­Ø¯Ø§Ø«Ø©', 'Ø§Ù„ØªÙƒØ±Ø§Ø±', 'Ø§Ù„Ù‚ÙŠÙ…Ø©_Ø§Ù„Ù…Ø§Ù„ÙŠØ©']
        
        # ØªØ·Ø¨ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        scaler = StandardScaler()
        rfm_scaled = scaler.fit_transform(rfm_data[['Ø§Ù„Ø­Ø¯Ø§Ø«Ø©', 'Ø§Ù„ØªÙƒØ±Ø§Ø±', 'Ø§Ù„Ù‚ÙŠÙ…Ø©_Ø§Ù„Ù…Ø§Ù„ÙŠØ©']])
        
        # ØªØ·Ø¨ÙŠÙ‚ K-Means
        n_clusters = min(3, len(rfm_data))
        kmeans = KMeans(n_clusters=n_clusters, random_state=42, n_init=10)
        rfm_data['Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©'] = kmeans.fit_predict(rfm_scaled)
        
        # ØªØ³Ù…ÙŠØ© Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª
        segment_names = {
            0: 'Ø¹Ù…Ù„Ø§Ø¡ VIP - Ø£ÙØ¶Ù„ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡',
            1: 'Ø¹Ù…Ù„Ø§Ø¡ Ù…ØªÙˆØ³Ø·ÙˆÙ† - Ø¥Ù…ÙƒØ§Ù†ÙŠØ© Ø§Ù„Ù†Ù…Ùˆ',
            2: 'Ø¹Ù…Ù„Ø§Ø¡ Ø¬Ø¯Ø¯ - ÙŠØ­ØªØ§Ø¬ÙˆÙ† Ø±Ø¹Ø§ÙŠØ©'
        }
        
        rfm_data['Ø§Ø³Ù…_Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©'] = rfm_data['Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©'].map(
            lambda x: segment_names.get(x, f'Ù…Ø¬Ù…ÙˆØ¹Ø© {x+1}')
        )
        
        print(f"   âœ… ØªÙ… ØªØ¬Ù…ÙŠØ¹ {len(rfm_data)} Ø¹Ù…ÙŠÙ„ Ø¥Ù„Ù‰ {n_clusters} Ù…Ø¬Ù…ÙˆØ¹Ø§Øª")
        
        for seg in range(n_clusters):
            seg_data = rfm_data[rfm_data['Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©'] == seg]
            print(f"   ğŸ“Š {segment_names.get(seg, f'Ù…Ø¬Ù…ÙˆØ¹Ø© {seg+1}')}: {len(seg_data)} Ø¹Ù…ÙŠÙ„")
        
        return {
            'status': 'success',
            'segments': rfm_data.to_dict('records'),
            'n_clusters': n_clusters,
            'segment_distribution': rfm_data['Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©'].value_counts().to_dict()
        }
    except Exception as e:
        logging.error(f"Ø®Ø·Ø£ ÙÙŠ ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡: {e}")
        return {'status': 'error', 'message': str(e)}


def ai_anomaly_detection(df):
    """
    ÙƒØ´Ù Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø´Ø§Ø°Ø© ÙÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª
    Detects anomalies in sales patterns using Isolation Forest
    """
    if not ML_AVAILABLE:
        return {'status': 'ML_NOT_AVAILABLE', 'anomalies': []}
    
    print("\n[AI-3/6] ğŸ” ÙƒØ´Ù Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø´Ø§Ø°Ø© ÙÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª...")
    
    try:
        # Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        features = df[['Ø³Ø¹Ø±_Ø§Ù„ÙˆØ­Ø¯Ø©', 'Ø§Ù„ÙƒÙ…ÙŠØ©', 'Ø¥Ø¬Ù…Ø§Ù„ÙŠ_Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª', 'ØµØ§ÙÙŠ_Ø§Ù„Ø±Ø¨Ø­', 'Ù‡Ø§Ù…Ø´_Ø§Ù„Ø±Ø¨Ø­_%']]
        
        # ØªØ·Ø¨ÙŠÙ‚ Isolation Forest
        iso_forest = IsolationForest(contamination=0.1, random_state=42)
        df['Ø´Ø§Ø°Ø©'] = iso_forest.fit_predict(features)
        
        # Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø´Ø§Ø°Ø© Ù‡ÙŠ -1
        anomalies = df[df['Ø´Ø§Ø°Ø©'] == -1].copy()
        normal = df[df['Ø´Ø§Ø°Ø©'] == 1].copy()
        
        print(f"   âœ… ØªÙ… ÙØ­Øµ {len(df)} Ù…Ø¹Ø§Ù…Ù„Ø©")
        print(f"   âš ï¸  ØªÙ… Ø§ÙƒØªØ´Ø§Ù {len(anomalies)} Ø­Ø§Ù„Ø© Ø´Ø§Ø°Ø© ({len(anomalies)/len(df)*100:.2f}%)")
        
        if len(anomalies) > 0:
            print(f"   ğŸ“Š Ù…ØªÙˆØ³Ø· Ù‚ÙŠÙ…Ø© Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø´Ø§Ø°Ø©: {anomalies['Ø¥Ø¬Ù…Ø§Ù„ÙŠ_Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª'].mean():,.0f} Ø±ÙŠØ§Ù„")
            print(f"   ğŸ’° Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø´Ø§Ø°Ø©: {anomalies['Ø¥Ø¬Ù…Ø§Ù„ÙŠ_Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª'].sum():,.0f} Ø±ÙŠØ§Ù„")
        
        return {
            'status': 'success',
            'total_anomalies': len(anomalies),
            'anomaly_percentage': float(len(anomalies)/len(df)*100),
            'anomaly_total_value': float(anomalies['Ø¥Ø¬Ù…Ø§Ù„ÙŠ_Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª'].sum()) if len(anomalies) > 0 else 0,
            'top_anomalies': anomalies.nlargest(5, 'Ø¥Ø¬Ù…Ø§Ù„ÙŠ_Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª')[
                ['Ø±Ù‚Ù…_Ø§Ù„Ø·Ù„Ø¨', 'Ø§Ù„Ù…Ù†ØªØ¬', 'Ø¥Ø¬Ù…Ø§Ù„ÙŠ_Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª', 'Ø§Ù„Ø±Ø¨Ø­']
            ].to_dict('records')
        }
    except Exception as e:
        logging.error(f"Ø®Ø·Ø£ ÙÙŠ ÙƒØ´Ù Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø´Ø§Ø°Ø©: {e}")
        return {'status': 'error', 'message': str(e)}


def ai_price_optimization(df):
    """
    Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… AI
    AI-powered dynamic price optimization suggestions
    """
    if not ML_AVAILABLE:
        return {'status': 'ML_NOT_AVAILABLE', 'suggestions': []}
    
    print("\n[AI-4/6] ğŸ’² ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠ...")
    
    try:
        # ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ø±ÙˆÙ†Ø© Ø§Ù„Ø³Ø¹Ø±ÙŠØ© Ù„ÙƒÙ„ Ù…Ù†ØªØ¬
        product_analysis = df.groupby('Ø§Ù„Ù…Ù†ØªØ¬').agg({
            'Ø³Ø¹Ø±_Ø§Ù„ÙˆØ­Ø¯Ø©': 'mean',
            'Ø§Ù„ÙƒÙ…ÙŠØ©': 'sum',
            'Ø¥Ø¬Ù…Ø§Ù„ÙŠ_Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª': 'sum',
            'ØµØ§ÙÙŠ_Ø§Ù„Ø±Ø¨Ø­': 'sum',
            'Ù‡Ø§Ù…Ø´_Ø§Ù„Ø±Ø¨Ø­_%': 'mean'
        }).reset_index()
        
        suggestions = []
        
        for _, product in product_analysis.iterrows():
            current_price = product['Ø³Ø¹Ø±_Ø§Ù„ÙˆØ­Ø¯Ø©']
            current_margin = product['Ù‡Ø§Ù…Ø´_Ø§Ù„Ø±Ø¨Ø­_%']
            total_sales = product['Ø¥Ø¬Ù…Ø§Ù„ÙŠ_Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª']
            
            suggestion = {
                'Ø§Ù„Ù…Ù†ØªØ¬': product['Ø§Ù„Ù…Ù†ØªØ¬'],
                'Ø§Ù„Ø³Ø¹Ø±_Ø§Ù„Ø­Ø§Ù„ÙŠ': float(current_price),
                'Ø§Ù„Ù‡Ø§Ù…Ø´_Ø§Ù„Ø­Ø§Ù„ÙŠ': float(current_margin)
            }
            
            # Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ø°ÙƒÙŠØ© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù‡Ø§Ù…Ø´
            if current_margin < 10:
                # Ù‡Ø§Ù…Ø´ Ù…Ù†Ø®ÙØ¶ - Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø³Ø¹Ø±
                suggested_price = current_price * 1.15
                suggestion['Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡'] = 'Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø³Ø¹Ø±'
                suggestion['Ø§Ù„Ø³Ø¹Ø±_Ø§Ù„Ù…Ù‚ØªØ±Ø­'] = float(suggested_price)
                suggestion['Ø§Ù„Ø³Ø¨Ø¨'] = 'Ù‡Ø§Ù…Ø´ Ø±Ø¨Ø­ Ù…Ù†Ø®ÙØ¶ Ø¬Ø¯Ø§Ù‹'
            elif current_margin > 50 and total_sales < product_analysis['Ø¥Ø¬Ù…Ø§Ù„ÙŠ_Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª'].median():
                # Ù‡Ø§Ù…Ø´ Ø¹Ø§Ù„ÙŠ Ù„ÙƒÙ† Ù…Ø¨ÙŠØ¹Ø§Øª Ù…Ù†Ø®ÙØ¶Ø© - ØªØ®ÙÙŠØ¶ Ù„Ù„ØªÙ†Ø§ÙØ³ÙŠØ©
                suggested_price = current_price * 0.90
                suggestion['Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡'] = 'ØªØ®ÙÙŠØ¶ Ø§Ù„Ø³Ø¹Ø±'
                suggestion['Ø§Ù„Ø³Ø¹Ø±_Ø§Ù„Ù…Ù‚ØªØ±Ø­'] = float(suggested_price)
                suggestion['Ø§Ù„Ø³Ø¨Ø¨'] = 'Ø²ÙŠØ§Ø¯Ø© Ø§Ù„ØªÙ†Ø§ÙØ³ÙŠØ© ÙˆØ­Ø¬Ù… Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª'
            else:
                suggestion['Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡'] = 'Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø§Ù„Ø³Ø¹Ø±'
                suggestion['Ø§Ù„Ø³Ø¹Ø±_Ø§Ù„Ù…Ù‚ØªØ±Ø­'] = float(current_price)
                suggestion['Ø§Ù„Ø³Ø¨Ø¨'] = 'Ø§Ù„Ø³Ø¹Ø± Ù…Ø«Ø§Ù„ÙŠ Ø­Ø§Ù„ÙŠØ§Ù‹'
            
            suggestions.append(suggestion)
        
        # Ø¹Ø¯Ø¯ Ø§Ù„ØªÙˆØµÙŠØ§Øª Ø¨Ø§Ù„ØªØºÙŠÙŠØ±
        changes = len([s for s in suggestions if s['Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡'] != 'Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø§Ù„Ø³Ø¹Ø±'])
        
        print(f"   âœ… ØªÙ… ØªØ­Ù„ÙŠÙ„ Ø£Ø³Ø¹Ø§Ø± {len(suggestions)} Ù…Ù†ØªØ¬")
        print(f"   ğŸ’¡ Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„ØªÙŠ ØªØ­ØªØ§Ø¬ ØªØ¹Ø¯ÙŠÙ„: {changes}")
        
        return {
            'status': 'success',
            'suggestions': suggestions,
            'total_products': len(suggestions),
            'products_need_change': changes
        }
    except Exception as e:
        logging.error(f"Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø³Ø¹Ø§Ø±: {e}")
        return {'status': 'error', 'message': str(e)}


def ai_product_recommendations(df):
    """
    ØªÙˆØµÙŠØ§Øª Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø°ÙƒÙŠØ© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø´Ø±Ø§Ø¡
    Smart product recommendations based on purchase patterns
    """
    print("\n[AI-5/6] ğŸ›’ ØªÙˆØµÙŠØ§Øª Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø°ÙƒÙŠØ©...")
    
    try:
        # ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªØ²Ø§Ù…Ù† ÙÙŠ Ø§Ù„Ø´Ø±Ø§Ø¡ (Ø£ÙŠ Ù…Ù†ØªØ¬Ø§Øª ØªÙØ´ØªØ±Ù‰ Ù…Ø¹Ø§Ù‹)
        # Ù…Ø¨Ø³Ø·: Ù†Ø­Ù„Ù„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø£ÙƒØ«Ø± Ù…Ø¨ÙŠØ¹Ø§Ù‹ ÙÙŠ Ù†ÙØ³ Ø§Ù„ÙØ¦Ø§Øª
        
        category_products = df.groupby(['Ø§Ù„ÙØ¦Ø©', 'Ø§Ù„Ù…Ù†ØªØ¬']).agg({
            'Ø§Ù„ÙƒÙ…ÙŠØ©': 'sum',
            'Ø¥Ø¬Ù…Ø§Ù„ÙŠ_Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª': 'sum'
        }).reset_index()
        
        recommendations = []
        
        for category in df['Ø§Ù„ÙØ¦Ø©'].unique():
            cat_products = category_products[category_products['Ø§Ù„ÙØ¦Ø©'] == category]
            top_products = cat_products.nlargest(3, 'Ø§Ù„ÙƒÙ…ÙŠØ©')
            
            for _, product in top_products.iterrows():
                # Ø§Ù‚ØªØ±Ø§Ø­ Ù…Ù†ØªØ¬Ø§Øª ØªÙƒÙ…ÙŠÙ„ÙŠØ© Ù…Ù† ÙØ¦Ø§Øª Ø£Ø®Ø±Ù‰
                complementary = category_products[
                    (category_products['Ø§Ù„ÙØ¦Ø©'] != category) & 
                    (category_products['Ø§Ù„ÙƒÙ…ÙŠØ©'] > category_products['Ø§Ù„ÙƒÙ…ÙŠØ©'].median())
                ].head(2)
                
                if len(complementary) > 0:
                    recommendations.append({
                        'Ø§Ù„Ù…Ù†ØªØ¬_Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ': product['Ø§Ù„Ù…Ù†ØªØ¬'],
                        'Ø§Ù„ÙØ¦Ø©': product['Ø§Ù„ÙØ¦Ø©'],
                        'Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª_Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø©': complementary['Ø§Ù„Ù…Ù†ØªØ¬'].tolist(),
                        'Ù‚ÙˆØ©_Ø§Ù„ØªÙˆØµÙŠØ©': 'Ø¹Ø§Ù„ÙŠØ©'
                    })
        
        print(f"   âœ… ØªÙ… ØªÙˆÙ„ÙŠØ¯ {len(recommendations)} ØªÙˆØµÙŠØ© Ø°ÙƒÙŠØ©")
        
        return {
            'status': 'success',
            'recommendations': recommendations[:10],  # Ø£ÙØ¶Ù„ 10 ØªÙˆØµÙŠØ§Øª
            'total_recommendations': len(recommendations)
        }
    except Exception as e:
        logging.error(f"Ø®Ø·Ø£ ÙÙŠ ØªÙˆØµÙŠØ§Øª Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª: {e}")
        return {'status': 'error', 'message': str(e)}


def ai_inventory_optimization(df, analysis):
    """
    ØªØ­Ø³ÙŠÙ† Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… AI
    AI-powered inventory optimization
    """
    print("\n[AI-6/6] ğŸ“¦ ØªØ­Ø³ÙŠÙ† Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ø°ÙƒÙŠ...")
    
    try:
        # ØªØ­Ù„ÙŠÙ„ Ø¯ÙˆØ±Ø§Ù† Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
        product_velocity = df.groupby('Ø§Ù„Ù…Ù†ØªØ¬').agg({
            'Ø§Ù„ÙƒÙ…ÙŠØ©': 'sum',
            'Ø§Ù„ØªØ§Ø±ÙŠØ®': lambda x: (x.max() - x.min()).days,
            'Ø±Ù‚Ù…_Ø§Ù„Ø·Ù„Ø¨': 'count',
            'Ø¥Ø¬Ù…Ø§Ù„ÙŠ_Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª': 'sum'
        }).reset_index()
        
        product_velocity['Ù…Ø¹Ø¯Ù„_Ø§Ù„Ø¨ÙŠØ¹_Ø§Ù„ÙŠÙˆÙ…ÙŠ'] = product_velocity['Ø§Ù„ÙƒÙ…ÙŠØ©'] / (
            product_velocity['Ø§Ù„ØªØ§Ø±ÙŠØ®'] + 1
        )
        
        inventory_suggestions = []
        
        for _, product in product_velocity.iterrows():
            daily_rate = product['Ù…Ø¹Ø¯Ù„_Ø§Ù„Ø¨ÙŠØ¹_Ø§Ù„ÙŠÙˆÙ…ÙŠ']
            
            suggestion = {
                'Ø§Ù„Ù…Ù†ØªØ¬': product['Ø§Ù„Ù…Ù†ØªØ¬'],
                'Ù…Ø¹Ø¯Ù„_Ø§Ù„Ø¨ÙŠØ¹_Ø§Ù„ÙŠÙˆÙ…ÙŠ': float(daily_rate),
                'Ø§Ù„ÙƒÙ…ÙŠØ©_Ø§Ù„Ù…Ø¨Ø§Ø¹Ø©_Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©': int(product['Ø§Ù„ÙƒÙ…ÙŠØ©'])
            }
            
            # Ø­Ø³Ø§Ø¨ Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø«Ù„Ù‰ (30 ÙŠÙˆÙ…)
            optimal_stock = daily_rate * 30
            
            # Ø­Ø³Ø§Ø¨ Ù†Ù‚Ø·Ø© Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø·Ù„Ø¨ (7 Ø£ÙŠØ§Ù…)
            reorder_point = daily_rate * 7
            
            suggestion['Ø§Ù„ÙƒÙ…ÙŠØ©_Ø§Ù„Ù…Ø«Ù„Ù‰_Ù„Ù„Ù…Ø®Ø²ÙˆÙ†'] = int(optimal_stock)
            suggestion['Ù†Ù‚Ø·Ø©_Ø¥Ø¹Ø§Ø¯Ø©_Ø§Ù„Ø·Ù„Ø¨'] = int(reorder_point)
            
            # ØªØµÙ†ÙŠÙ Ø³Ø±Ø¹Ø© Ø§Ù„Ø­Ø±ÙƒØ©
            if daily_rate > product_velocity['Ù…Ø¹Ø¯Ù„_Ø§Ù„Ø¨ÙŠØ¹_Ø§Ù„ÙŠÙˆÙ…ÙŠ'].quantile(0.75):
                suggestion['Ø§Ù„ØªØµÙ†ÙŠÙ'] = 'Ø³Ø±ÙŠØ¹ Ø§Ù„Ø­Ø±ÙƒØ©'
                suggestion['Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©'] = 'Ø¹Ø§Ù„ÙŠØ©'
            elif daily_rate > product_velocity['Ù…Ø¹Ø¯Ù„_Ø§Ù„Ø¨ÙŠØ¹_Ø§Ù„ÙŠÙˆÙ…ÙŠ'].quantile(0.25):
                suggestion['Ø§Ù„ØªØµÙ†ÙŠÙ'] = 'Ù…ØªÙˆØ³Ø· Ø§Ù„Ø­Ø±ÙƒØ©'
                suggestion['Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©'] = 'Ù…ØªÙˆØ³Ø·Ø©'
            else:
                suggestion['Ø§Ù„ØªØµÙ†ÙŠÙ'] = 'Ø¨Ø·ÙŠØ¡ Ø§Ù„Ø­Ø±ÙƒØ©'
                suggestion['Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©'] = 'Ù…Ù†Ø®ÙØ¶Ø©'
            
            inventory_suggestions.append(suggestion)
        
        # ØªØ±ØªÙŠØ¨ Ø­Ø³Ø¨ Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¨ÙŠØ¹
        inventory_suggestions = sorted(
            inventory_suggestions, 
            key=lambda x: x['Ù…Ø¹Ø¯Ù„_Ø§Ù„Ø¨ÙŠØ¹_Ø§Ù„ÙŠÙˆÙ…ÙŠ'], 
            reverse=True
        )
        
        print(f"   âœ… ØªÙ… ØªØ­Ù„ÙŠÙ„ {len(inventory_suggestions)} Ù…Ù†ØªØ¬")
        fast_moving = len([s for s in inventory_suggestions if s['Ø§Ù„ØªØµÙ†ÙŠÙ'] == 'Ø³Ø±ÙŠØ¹ Ø§Ù„Ø­Ø±ÙƒØ©'])
        print(f"   ğŸ“Š Ù…Ù†ØªØ¬Ø§Øª Ø³Ø±ÙŠØ¹Ø© Ø§Ù„Ø­Ø±ÙƒØ©: {fast_moving}")
        
        return {
            'status': 'success',
            'inventory_suggestions': inventory_suggestions,
            'fast_moving_count': fast_moving,
            'total_products': len(inventory_suggestions)
        }
    except Exception as e:
        logging.error(f"Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø³ÙŠÙ† Ø§Ù„Ù…Ø®Ø²ÙˆÙ†: {e}")
        return {'status': 'error', 'message': str(e)}


def create_ai_visualizations(df, ai_results):
    """
    Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø³ÙˆÙ… Ø¨ÙŠØ§Ù†ÙŠØ© Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ
    Create visualizations for AI results
    """
    print("\n[AI-VIZ] ğŸ“Š Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø³ÙˆÙ… Ø¨ÙŠØ§Ù†ÙŠØ© Ù„Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ...")
    
    plots = []
    
    try:
        # 1. Ø±Ø³Ù… Ø§Ù„ØªÙ†Ø¨Ø¤Ø§Øª
        if ai_results.get('forecasting', {}).get('status') == 'success':
            plt.figure(figsize=(12, 6))
            predictions = ai_results['forecasting']['predictions']
            plt.plot(range(1, len(predictions)+1), predictions, marker='o', linewidth=2, color='#2ecc71')
            plt.title('Ø§Ù„ØªÙ†Ø¨Ø¤ Ø¨Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ù„Ù€ 30 ÙŠÙˆÙ… Ù‚Ø§Ø¯Ù… - AI Forecasting', fontsize=16, pad=20)
            plt.xlabel('Ø§Ù„ÙŠÙˆÙ…', fontsize=12)
            plt.ylabel('Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø© (Ø±ÙŠØ§Ù„)', fontsize=12)
            plt.grid(True, alpha=0.3)
            plt.tight_layout()
            filename = 'ai_sales_forecast.png'
            plt.savefig(filename, dpi=300, bbox_inches='tight')
            plt.close()
            plots.append(filename)
            print(f"   âœ… {filename}")
        
        # 2. Ø±Ø³Ù… ØªÙˆØ²ÙŠØ¹ Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡
        if ai_results.get('segmentation', {}).get('status') == 'success':
            seg_dist = ai_results['segmentation'].get('segment_distribution', {})
            if seg_dist:
                plt.figure(figsize=(10, 6))
                labels = [f'Ù…Ø¬Ù…ÙˆØ¹Ø© {k+1}' for k in seg_dist.keys()]
                plt.pie(seg_dist.values(), labels=labels, autopct='%1.1f%%', startangle=90)
                plt.title('ØªÙˆØ²ÙŠØ¹ Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ - AI Segmentation', fontsize=16, pad=20)
                plt.tight_layout()
                filename = 'ai_customer_segments.png'
                plt.savefig(filename, dpi=300, bbox_inches='tight')
                plt.close()
                plots.append(filename)
                print(f"   âœ… {filename}")
        
        # 3. Ø±Ø³Ù… Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø´Ø§Ø°Ø©
        if ai_results.get('anomalies', {}).get('status') == 'success':
            anomaly_data = ai_results['anomalies']
            if anomaly_data.get('top_anomalies'):
                plt.figure(figsize=(12, 6))
                anomalies = anomaly_data['top_anomalies']
                products = [a['Ø§Ù„Ù…Ù†ØªØ¬'][:20] for a in anomalies]
                values = [a['Ø¥Ø¬Ù…Ø§Ù„ÙŠ_Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª'] for a in anomalies]
                plt.barh(products, values, color='#e74c3c')
                plt.title('Ø£Ø¹Ù„Ù‰ 5 Ø­Ø§Ù„Ø§Øª Ø´Ø§Ø°Ø© ÙÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª - Anomaly Detection', fontsize=16, pad=20)
                plt.xlabel('Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª (Ø±ÙŠØ§Ù„)', fontsize=12)
                plt.tight_layout()
                filename = 'ai_anomalies.png'
                plt.savefig(filename, dpi=300, bbox_inches='tight')
                plt.close()
                plots.append(filename)
                print(f"   âœ… {filename}")
        
        print(f"   ğŸ“ˆ ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ {len(plots)} Ø±Ø³Ù… Ø¨ÙŠØ§Ù†ÙŠ Ù„Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ")
        
    except Exception as e:
        logging.error(f"Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø³ÙˆÙ… AI: {e}")
    
    return plots


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# [7] MAIN EXECUTION - ØªÙ†ÙÙŠØ° Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

def main():
    """
    Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ù†Ø¸Ø§Ù… Ù…Ø¹ Ù…ÙŠØ²Ø§Øª Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ
    Main function with AI capabilities
    """
    print("\n" + "=" * 70)
    print("Ø¨Ø¯Ø¡ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø´Ø§Ù…Ù„Ø© Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ...")
    print("=" * 70)
    
    # 1. ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    df = generate_advanced_salla_data()
    
    # 2. Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠ
    analysis = perform_advanced_analysis(df)
    
    # 3. Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ©
    plots = create_advanced_visualizations(df, analysis)
    
    # 4. Ø§Ù„ØªÙˆØµÙŠØ§Øª Ø§Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ©
    recommendations = generate_strategic_recommendations(df, analysis)
    
    # 5. Ø­Ø³Ø§Ø¨ KPIs
    kpis = calculate_advanced_kpis(df, analysis)
    
    # === Ù…ÙŠØ²Ø§Øª Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ===
    print("\n" + "=" * 70)
    print("ğŸ¤– ØªØ´ØºÙŠÙ„ Ù…Ø­Ø±Ùƒ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ...")
    print("=" * 70)
    
    ai_results = {}
    
    if ML_AVAILABLE:
        # 6. Ø§Ù„ØªÙ†Ø¨Ø¤ Ø¨Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª
        ai_results['forecasting'] = ai_sales_forecasting(df)
        
        # 7. ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡
        ai_results['segmentation'] = ai_customer_segmentation(df)
        
        # 8. ÙƒØ´Ù Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø´Ø§Ø°Ø©
        ai_results['anomalies'] = ai_anomaly_detection(df)
        
        # 9. ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø£Ø³Ø¹Ø§Ø±
        ai_results['price_optimization'] = ai_price_optimization(df)
        
        # 10. ØªÙˆØµÙŠØ§Øª Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
        ai_results['product_recommendations'] = ai_product_recommendations(df)
        
        # 11. ØªØ­Ø³ÙŠÙ† Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
        ai_results['inventory_optimization'] = ai_inventory_optimization(df, analysis)
        
        # 12. Ø±Ø³ÙˆÙ… Ø¨ÙŠØ§Ù†ÙŠØ© Ù„Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ
        ai_plots = create_ai_visualizations(df, ai_results)
        plots.extend(ai_plots)
    else:
        print("âš ï¸  ØªØ®Ø·ÙŠ Ù…ÙŠØ²Ø§Øª Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ - Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª ØºÙŠØ± Ù…ØªÙˆÙØ±Ø©")
    
    # 13. Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    print("\n[SAVE] ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„Ù†ØªØ§Ø¦Ø¬...")
    df.to_csv('salla_data_full.csv', index=False, encoding='utf-8-sig')
    print("   âœ… ØªÙ… Ø­ÙØ¸: salla_data_full.csv")
    
    # 14. ØªØµØ¯ÙŠØ± Ù…Ù„Ø®Øµ JSON Ù…Ø­Ø³Ù‘Ù† Ù…Ø¹ Ù†ØªØ§Ø¦Ø¬ AI
    summary = {
        'kpis': {k: str(v) for k, v in kpis.items()},
        'analysis_summary': {
            'total_revenue': float(analysis['Ø¥Ø¬Ù…Ø§Ù„ÙŠ_Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª']),
            'total_profit': float(analysis['ØµØ§ÙÙŠ_Ø§Ù„Ø±Ø¨Ø­']),
            'profit_margin': float(analysis['Ù‡Ø§Ù…Ø´_Ø§Ù„Ø±Ø¨Ø­_Ø§Ù„ÙƒÙ„ÙŠ']),
            'total_orders': int(analysis['Ø¹Ø¯Ø¯_Ø§Ù„Ø·Ù„Ø¨Ø§Øª']),
        },
        'top_products': {k: float(v) for k, v in list(analysis['Ø£ÙØ¶Ù„_5_Ù…Ù†ØªØ¬Ø§Øª'].items())},
        'ai_insights': ai_results if ML_AVAILABLE else {'status': 'ML_NOT_AVAILABLE'}
    }
    
    with open('analysis_summary_ai.json', 'w', encoding='utf-8') as f:
        json.dump(summary, f, ensure_ascii=False, indent=2)
    print("   âœ… ØªÙ… Ø­ÙØ¸: analysis_summary_ai.json")
    
    print("\n" + "=" * 70)
    print("âœ… Ø§ÙƒØªÙ…Ù„ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­!")
    print("=" * 70)
    print(f"\nğŸ“Š Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©:")
    print(f"   â€¢ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª: {analysis['Ø¥Ø¬Ù…Ø§Ù„ÙŠ_Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª']:,.0f} Ø±ÙŠØ§Ù„")
    print(f"   â€¢ ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­: {analysis['ØµØ§ÙÙŠ_Ø§Ù„Ø±Ø¨Ø­']:,.0f} Ø±ÙŠØ§Ù„")
    print(f"   â€¢ Ù‡Ø§Ù…Ø´ Ø§Ù„Ø±Ø¨Ø­: {analysis['Ù‡Ø§Ù…Ø´_Ø§Ù„Ø±Ø¨Ø­_Ø§Ù„ÙƒÙ„ÙŠ']:.2f}%")
    print(f"   â€¢ Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø¨Ø§Øª: {analysis['Ø¹Ø¯Ø¯_Ø§Ù„Ø·Ù„Ø¨Ø§Øª']:,}")
    print(f"   â€¢ Ù…ØªÙˆØ³Ø· Ù‚ÙŠÙ…Ø© Ø§Ù„Ø·Ù„Ø¨: {analysis['Ù…ØªÙˆØ³Ø·_Ù‚ÙŠÙ…Ø©_Ø§Ù„Ø·Ù„Ø¨']:,.0f} Ø±ÙŠØ§Ù„")
    
    print(f"\nğŸ“ˆ ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ {len(plots)} Ø±Ø³Ù… Ø¨ÙŠØ§Ù†ÙŠ Ø§Ø­ØªØ±Ø§ÙÙŠ")
    print(f"ğŸ’¡ ØªÙ… ØªÙˆÙ„ÙŠØ¯ {sum(len(v) for v in recommendations.values())} ØªÙˆØµÙŠØ© Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ©")
    
    if ML_AVAILABLE:
        print(f"\nğŸ¤– Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ:")
        if ai_results.get('forecasting', {}).get('status') == 'success':
            print(f"   â€¢ Ø§Ù„ØªÙ†Ø¨Ø¤ Ø¨Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª: {ai_results['forecasting']['total_predicted']:,.0f} Ø±ÙŠØ§Ù„ Ù„Ù„Ø´Ù‡Ø± Ø§Ù„Ù‚Ø§Ø¯Ù…")
        if ai_results.get('anomalies', {}).get('status') == 'success':
            print(f"   â€¢ ØªÙ… Ø§ÙƒØªØ´Ø§Ù {ai_results['anomalies']['total_anomalies']} Ø­Ø§Ù„Ø© Ø´Ø§Ø°Ø©")
        if ai_results.get('price_optimization', {}).get('status') == 'success':
            print(f"   â€¢ {ai_results['price_optimization']['products_need_change']} Ù…Ù†ØªØ¬ ÙŠØ­ØªØ§Ø¬ ØªØ¹Ø¯ÙŠÙ„ Ø³Ø¹Ø±")
    
    print("\n" + "=" * 70)
    print("ğŸ¯ Ø§Ù„Ù†Ø¸Ø§Ù… Ø¬Ø§Ù‡Ø² Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…Ø¹ Ù‚Ø¯Ø±Ø§Øª Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø§Ù„ÙƒØ§Ù…Ù„Ø©!")
    print("=" * 70)
    
    return df, analysis, plots, recommendations, kpis, ai_results if ML_AVAILABLE else {}


if __name__ == "__main__":
    results = main()
    if len(results) == 6:
        df, analysis, plots, recommendations, kpis, ai_results = results
        print("\nâœ… Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙŠØ²Ø§Øª ØªØ¹Ù…Ù„ Ø¨Ù†Ø¬Ø§Ø­ - Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªÙ‚Ù„ÙŠØ¯ÙŠ + Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ!")
    else:
        print("\nâœ… Ø§ÙƒØªÙ…Ù„ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ!")
